(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();let m=null;const c={init:r=>{m=r},sortEntity:r=>[...r].sort((t,e)=>t.zIndex-e.zIndex||t.y-e.y),createImage:(r,t=[])=>{const e=new Image;return e.src=r,e.sprites=t,e},drawSprite:(r,t,e,s,a,i)=>{let o=r.sprites[t];m.ctx.drawImage(r,o.x,o.y,a,i,e-o.w/2,s-o.h/2,o.w,o.h)},drawAnimatedSprite:(r,t,e,s,a,i,o)=>{let n=r.sprites[t];m.ctx.drawImage(r,n.frames[parseInt(e)],n.y,i,o,s-n.w/2,a-n.h/2,n.w,n.h)}},w="/tower-defense/assets/laser-DtsNZ3_M.png",A="data:audio/mpeg;base64,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",h={playerLifes:10,coins:180,towers:{laser:{costs:80,color:"#ffff03",size:20,fireRange:110,damage:{from:3,to:4},coolDownTime:.6,images:c.createImage(w,[{x:0,y:0,w:80,h:80},{x:0,y:160,w:80,h:80},{x:0,y:320,w:80,h:80},{x:0,y:480,w:80,h:80},{x:0,y:640,w:80,h:80},{x:0,y:800,w:80,h:80}]),audio:A,upgrades:[{cost:120,fireRange:120,damage:{from:7,to:11},color:"#2CE85B"},{cost:190,fireRange:130,damage:{from:14,to:21},color:"#2CE8B9"},{cost:280,fireRange:140,damage:{from:23,to:34},color:"#2A62DB"}]}},mapGrid:80,enemyLevelIncAt:15,enemyLevels:[{speed:45,health:20,color:"rgb(250,0,0)"},{speed:60,health:35,color:"rgb(200,0,0)"},{speed:90,health:50,color:"rgb(150,0,0)"},{speed:120,health:80,color:"rgb(100,0,0)"},{speed:90,health:100,color:"rgb(50,0,0)"},{speed:60,health:150,color:"rgb(30,30,30)"},{speed:60,health:120,color:"rgb(15,15,15)"},{speed:150,health:160,color:"rgb(0,0,0)"}],waves:[{name:"A lot small enemies",template:[{count:4,waveFactor:1,coolDown:800,level:0,delay:0,delayFactor:.5},{count:0,waveFactor:.4,coolDown:500,level:1,delay:0,delayFactor:0}]}]},f="/tower-defense/assets/background-C4SR3P4r.png";class x{constructor(t,e){this.game=t,this.mapEntities=e,this.waypoints=[{x:0,y:120},{x:120,y:120},{x:120,y:360},{x:360,y:360},{x:360,y:200},{x:520,y:200},{x:520,y:520},{x:680,y:520},{x:680,y:280},{x:800,y:280},{x:920,y:280},{x:920,y:200},{x:1200,y:200}],this.images={background:c.createImage(f)},this.game.on("update",()=>this.update()),this.game.on("beforeDraw",()=>this.draw())}update(){}draw(){this.game.ctx.drawImage(this.images.background,0,0,this.game.canvas.width,this.game.canvas.height),this.grid(h.mapGrid)}isValidTowerPlace(t,e,s){const a={left:t-h.towers[s].size,top:e-h.towers[s].size,right:t+h.towers[s].size,bottom:e+h.towers[s].size};for(let i=0;i<this.waypoints.length-1;i++){let o=Math.min(this.waypoints[i+1].x,this.waypoints[i].x),n=Math.min(this.waypoints[i+1].y,this.waypoints[i].y),l=Math.max(this.waypoints[i+1].x,this.waypoints[i].x),d=Math.max(this.waypoints[i+1].y,this.waypoints[i].y),p=l-o+80,u=d-n+80;o-=40,n-=40,l=o+p,d=n+u;let y={left:o,top:n,right:l,bottom:d};if(this.game.intersectRect(a,y))return!1}for(let i in this.mapEntities.list){let o=this.mapEntities.list[i];if(o.type==="tower"&&this.game.distance(o.x,o.y,t,e)<=h.towers[s].size*2)return!1}return!0}grid(t){this.game.ctx.beginPath(),this.game.ctx.strokeStyle="#ffffff22",this.game.ctx.lineWidth=1;for(let e=t;e<this.game.canvas.height;e+=t)this.game.ctx.moveTo(0,e),this.game.ctx.lineTo(this.game.canvas.width,e);for(let e=t;e<this.game.canvas.width;e+=t)this.game.ctx.moveTo(e,0),this.game.ctx.lineTo(e,this.game.canvas.height);this.game.ctx.stroke()}}class v{constructor(t){this.game=t,this.list={},this.idCounter=0,this.game.on("update",e=>this.update(e)),this.game.on("beforeDraw",()=>this.draw())}add(t){const e=++this.idCounter;return t.id=e,this.list[e]=t,t}remove(t){this.list[t]&&delete this.list[t]}update(t){const e=Object.keys(this.list);for(const s of e){const a=this.list[s];a&&a.update(t)}}draw(){for(const t in this.list)this.game.drawList.push(this.list[t])}}class E{constructor(t){this.game=t,this.x=0,this.y=0,this.clicked=!1,this.game.canvas.addEventListener("mousemove",e=>this.onMove(e)),this.game.canvas.addEventListener("click",e=>this.onClick(e))}update(){this.clicked=!1}onMove(t){this.x=t.offsetX,this.y=t.offsetY}onClick(t){this.clicked=!0}isMouseOver(t,e,s){return Math.round(Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-e,2)))<=s}}class g{constructor(t,e,s,a,i){this.game=t,this.type="entity",this.x=e,this.y=s,this.r=a,this.color=i,this.zIndex=0}update(t){}draw(){this.game.drawCircle(this.x,this.y,this.r,this.color,!0)}remove(){this.game.mapEntities.remove(this.id)}}const C="/tower-defense/assets/irlicht-DEJtt0a3.png",M="/tower-defense/assets/bug-C3HbAPzA.png";class B extends g{constructor(t,e,s){const a=h.enemyLevels[t]||h.enemyLevels[h.enemyLevels.length-1];super(s.game,0,0,10,a.color),this.enemiesController=s,this.type="enemy";const i=Math.round(Math.random()*40)-10;this.waypointIndex=0,this.waypoint={},this.shift=i,this.velocity={x:0,y:0},this.level=t,this.wave=e,this.speed=a.speed,this.health=a.health,this.maxHealth=a.health,this.direction=0,this.frame=0,this.enemyType="irlicht",this.deleted=!1,this.zIndex=5,this.enemiesController.mapEntities.add(this),this.nextWaypoint()}nextWaypoint(){const t=this.enemiesController.map;this.waypoint.x||(this.waypoint={...t.waypoints[this.waypointIndex]},this.waypoint.x+=this.shift,this.waypoint.y+=this.shift,this.x=this.waypoint.x,this.y=this.waypoint.y);let e=this.waypoint.x,s=this.waypoint.y;return this.waypointIndex++,t.waypoints[this.waypointIndex]?(this.waypoint={...t.waypoints[this.waypointIndex]},this.waypoint.x+=this.shift,this.waypoint.y+=this.shift,this.velocity.x=this.x<this.waypoint.x?this.speed:-this.speed,e===this.waypoint.x&&(this.velocity.x=0),this.velocity.y=this.y<this.waypoint.y?this.speed:-this.speed,s===this.waypoint.y&&(this.velocity.y=0),this.velocity.y<0?this.direction=0:this.velocity.x>0?this.direction=1:this.velocity.y>0?this.direction=2:this.velocity.x<0&&(this.direction=3),!0):(this.done(),!1)}waypointReached(){return this.velocity.x>0&&this.x>=this.waypoint.x||this.velocity.x<0&&this.x<=this.waypoint.x||this.velocity.y>0&&this.y>=this.waypoint.y||this.velocity.y<0&&this.y<=this.waypoint.y}update(t){this.deleted||(this.waypointReached()?this.nextWaypoint():(this.x+=this.velocity.x*t,this.y+=this.velocity.y*t),this.frame=(this.frame+6*t)%this.enemiesController.images[this.enemyType].sprites[this.direction].frames.length)}draw(){c.drawAnimatedSprite(this.enemiesController.images[this.enemyType],this.direction,this.frame,Math.round(this.x),Math.round(this.y),40,40);const t=this.health/this.maxHealth;if(t<1){const e={x:this.x-this.r,y:this.y-this.r-5,width:this.r*2,height:3};this.game.ctx.fillStyle="black",this.game.ctx.fillRect(e.x,e.y,e.width,e.height),this.game.ctx.fillStyle="green",this.game.ctx.fillRect(e.x,e.y,e.width*t,e.height)}}damage(t){this.deleted||(this.health-=t,this.health<=0&&this.die())}die(){this.deleted||(this.health=0,this.deleted=!0,this.game.stat("coins",this.game.stat("coins")+this.enemiesController.calculateReward(this.level),!0),this.enemiesController.remove(this))}done(){if(this.deleted)return;this.deleted=!0;let t=this.game.stat("life")-1;t<=0?this.game.setGameOver():this.game.stat("life",t,!0),this.enemiesController.remove(this)}}class T{constructor(t,e,s){this.game=t,this.map=e,this.mapEntities=s,this.images={irlicht:c.createImage(C,[{x:0,y:0,w:20,h:20,frames:[0,40,80,120,160,200]},{x:0,y:40,w:20,h:20,frames:[0,40,80,120,160,200]},{x:0,y:80,w:20,h:20,frames:[0,40,80,120,160,200]},{x:0,y:120,w:20,h:20,frames:[0,40,80,120,160,200]}]),bug:c.createImage(M,[{x:0,y:0,w:20,h:20},{x:40,y:0,w:20,h:20},{x:80,y:0,w:20,h:20},{x:120,y:0,w:20,h:20}])},this.enemiesList=[]}create(t,e){const s=new B(t,e,this);return this.enemiesList.push(s),s}remove(t){if(!t)return;const e=this.enemiesList.indexOf(t);e>-1&&this.enemiesList.splice(e,1),this.mapEntities.remove(t.id)}calculateReward(t){const e=h.enemyLevels[0],s=h.enemyLevels[t];return Math.round(s.health/e.health*(s.speed/e.speed))+4}}class I extends g{constructor(t,e,s,a){const i=h.towers[s];super(a.game,t,e,i.size,i.color),this.towersController=a,this.type="tower",this.bullet=s,this.fireRange=i.fireRange,this.damage=i.damage,this.cooldownTime=i.coolDownTime,this.level=0,this.audio=new Audio(i.audio),this.audio.volume=.3,this.stats={shoots:0,dmg:0,kills:0},this.cooldownCounter=0,this.closestEnemy=!1,this.towersController.mapEntities.add(this)}upgrade(){const t=this.towersController.game,e=t.stat("coins"),s=h.towers[this.bullet].upgrades[this.level];s&&e>=s.cost&&(t.stat("coins",e-s.cost,!0),this.damage=s.damage,this.fireRange=s.fireRange,this.level++,this.color=s.color,this.towersController.closeOptions())}update(t){const{game:e,mouse:s}=this.towersController;this.cooldownCounter+=t,this.closestEnemy&&(e.distance(this.x,this.y,this.closestEnemy.x,this.closestEnemy.y)>=this.fireRange+this.closestEnemy.r||this.closestEnemy.health<=0)&&(this.closestEnemy=!1),this.closestEnemy||(this.closestEnemy=this.findClosestEnemy()),this.closestEnemy&&this.cooldownCounter>=this.cooldownTime&&(this.shoot(this.closestEnemy),this.audio.play().catch(()=>{}),this.cooldownCounter=0),this.zIndex=s.isMouseOver(this.x,this.y,this.r)?20:10,e.stat("mode")!=="dropTower"&&s.clicked&&s.isMouseOver(this.x,this.y,this.r)&&this.towersController.openOptions(this)}findClosestEnemy(){const{game:t,enemies:e}=this.towersController;let s=null,a=-1,i=1/0;for(const o of e.enemiesList)if(t.distance(this.x,this.y,o.x,o.y)<=this.fireRange+o.r){if(o.waypointIndex>a)a=o.waypointIndex,s=o,i=o.waypoint?t.distance(o.x,o.y,o.waypoint.x,o.waypoint.y):1/0;else if(o.waypointIndex===a&&o.waypoint){const l=t.distance(o.x,o.y,o.waypoint.x,o.waypoint.y);l<i&&(s=o,i=l)}}return s}shoot(t){const e=Math.floor(Math.random()*(this.damage.to-this.damage.from+1))+this.damage.from;this.stats.shoots++,this.stats.dmg+=e,t.damage(e),t.deleted&&this.stats.kills++,this.cooldownCounter=this.cooldownTime,this.shootingAt=t,setTimeout(()=>{this.shootingAt=null},100)}draw(){const{game:t,mouse:e}=this.towersController;e.isMouseOver(this.x,this.y,this.r)&&t.stat("mode")!=="dropTower"&&t.drawCircle(this.x,this.y,this.fireRange,"rgba(0,0,255,0.2)",!0),c.drawSprite(h.towers[this.bullet].images,this.level,this.x,this.y-20,160,160),this.shootingAt&&(t.ctx.save(),t.ctx.beginPath(),t.ctx.strokeStyle=this.color,t.ctx.lineWidth=2,t.ctx.moveTo(this.x,this.y-50),t.ctx.lineTo(this.shootingAt.x,this.shootingAt.y),t.ctx.stroke(),t.ctx.restore())}}class L{constructor(t,e,s,a,i){this.game=t,this.map=e,this.mouse=s,this.mapEntities=a,this.enemies=i,this.optionsModal=null,this.optionsModal=document.querySelector(".modal-options"),this.game.on("update",()=>this.update()),this.game.on("afterDraw",()=>this.draw())}update(){const t=this.gridPosition(),e=this.game.stat("selectedTowerType");this.game.stat("mode")==="dropTower"&&this.map.isValidTowerPlace(t.x,t.y,e)&&this.mouse.clicked&&(this.game.stat("mode",""),this.create(t.x,t.y,e))}draw(){if(this.game.stat("mode")==="dropTower"){const t=this.gridPosition(),e=this.game.stat("selectedTowerType");this.map.isValidTowerPlace(t.x,t.y,e)?(this.game.drawCircle(t.x,t.y,h.towers[e].fireRange,"rgba(0,0,255,0.2)",!0),c.drawSprite(h.towers[e].images,0,t.x,t.y-20,160,160)):(this.game.ctx.save(),this.game.ctx.filter="grayscale(100%)",c.drawSprite(h.towers[e].images,0,t.x,t.y-20,160,160),this.game.ctx.restore())}}create(t,e,s){return new I(t,e,s,this)}gridPosition(){const t=Math.floor(this.mouse.x/h.mapGrid)*h.mapGrid+h.mapGrid/2,e=Math.floor(this.mouse.y/h.mapGrid)*h.mapGrid+h.mapGrid/2;return{x:t,y:e}}openOptions(t){this.game.output("#tower-position-x",t.x),this.game.output("#tower-position-y",t.y),this.game.output("#tower-level",t.level+1),this.game.output("#tower-fire-range",t.fireRange),this.game.output("#tower-cooldown-time",t.cooldownTime),this.game.output("#tower-damage-from",t.damage.from),this.game.output("#tower-damage-to",t.damage.to),this.game.output("#tower-stats-shoots",t.stats.shoots),this.game.output("#tower-stats-damage",t.stats.dmg),this.game.output("#tower-stats-kills",t.stats.kills);const e=h.towers[t.bullet].upgrades[t.level],s=this.optionsModal.querySelector(".tower-upgrade");e?(s.classList.remove("is--hidden"),this.game.output(".tower-upgrade-level",t.level+2),this.game.output("#tower-upgrade-cost",e.cost),this.game.output("#tower-upgrade-fire-range",e.fireRange),this.game.output("#tower-upgrade-damage-from",e.damage.from),this.game.output("#tower-upgrade-damage-to",e.damage.to),this.optionsModal.querySelector(".tower-buy-upgrade").onclick=()=>t.upgrade()):s.classList.add("is--hidden"),this.optionsModal.classList.add("is--open")}closeOptions(){this.optionsModal.classList.remove("is--open")}}class O{constructor(){c.init(this),this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.drawList=[],this.stats={},this._outputCache={},this.waveCounter=0,this.gameOver=!1,this.eventsList={},this.lastFrameTime=0,this.mapEntities=new v(this),this.map=new x(this,this.mapEntities),this.mouse=new E(this),this.enemies=new T(this,this.map,this.mapEntities),this.towers=new L(this,this.map,this.mouse,this.mapEntities,this.enemies),document.addEventListener("click",t=>{if(this.gameOver){this.resetGame();return}t.target.matches("#buy-tower")&&(t.preventDefault(),this.buyTower("laser")),t.target.matches("#next-wave")&&(t.preventDefault(),this.nextWave()),t.target.matches(".modal-close")&&(t.preventDefault(),this.towers.closeOptions())},!1),this.output("#towerCosts",h.towers.laser.costs),this.resetGame(),window.requestAnimationFrame(this.draw.bind(this))}resetGame(){this.gameOver=!1,this.waveCounter=0,this.mapEntities.list={},this.stat("life",h.playerLifes,!0),this.stat("coins",h.coins,!0),this.stat("wave",0,!0),this.stat("mode","")}buyTower(t){if(this.stat("mode")!=="dropTower"){const e=this.stat("coins");e>=h.towers[t].costs&&(this.stat("mode","dropTower"),this.stat("selectedTowerType",t),this.stat("coins",e-h.towers[t].costs,!0))}}update(t){this.gameOver||(this.trigger("update",t),this.mouse.update())}draw(t){t||(t=0);const e=(t-this.lastFrameTime)/1e3;if(this.lastFrameTime=t,this.gameOver){window.requestAnimationFrame(this.draw.bind(this));return}window.requestAnimationFrame(this.draw.bind(this)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(e),this.trigger("beforeDraw"),this.drawList=c.sortEntity(this.drawList);for(const s of this.drawList)s.draw();this.drawList=[],this.trigger("afterDraw")}setGameOver(){this.gameOver=!0,this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="48px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("Game Over",this.canvas.width/2,this.canvas.height/2-40),this.ctx.font="24px sans-serif",this.ctx.fillText("Klicken zum Neustarten",this.canvas.width/2,this.canvas.height/2+20)}stat(t,e,s){return e===void 0?this.stats[t]||!1:(this.stats[t]=e,s!==void 0&&this.output(`#${t}`,e),this)}output(t,e){this._outputCache[t]||(this._outputCache[t]=document.querySelectorAll(t)),this._outputCache[t]&&this._outputCache[t].forEach(s=>{s.innerHTML=e})}distance(t,e,s,a){let i=t-s,o=e-a;return Math.sqrt(i*i+o*o)}intersectRect(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}drawCircle(t,e,s,a,i=!0){this.ctx.beginPath(),this.ctx.arc(t,e,s,0,2*Math.PI),i===!0?(this.ctx.fillStyle=a,this.ctx.fill()):(this.ctx.strokeStyle=a,this.ctx.stroke())}nextWave(){if(Object.keys(this.mapEntities.list).length===0)return this;this.waveCounter++,this.stat("wave",this.waveCounter,!0);let t=0,e=Math.floor(this.waveCounter/h.enemyLevelIncAt),s=h.waves.length-1,a=h.waves[Math.min(e,s)].template,i=this.waveCounter;for(let o of a){let n=Math.round(o.count+i*o.waveFactor);setTimeout(()=>{for(let l=0;l<n;l++)setTimeout(()=>{this.enemies.create(o.level+e,i)},l*o.coolDown)},t),t+=(o.delay+n*o.coolDown)*o.delayFactor}return this}on(t,e){return this.eventsList[t]||(this.eventsList[t]=[]),this.eventsList[t].push(e),this}off(t,e){if(!this.eventsList[t])return this;if(e){const s=this.eventsList[t].indexOf(e);s!==-1&&this.eventsList[t].splice(s,1)}else delete this.eventsList[t];return this}trigger(t,e){if(!this.eventsList[t])return this;for(let s=0;s<this.eventsList[t].length;s++)this.eventsList[t][s](e);return this}}document.addEventListener("DOMContentLoaded",()=>{new O});
