var Nt=Object.defineProperty;var Ht=(s,t,e)=>t in s?Nt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var B=(s,t,e)=>Ht(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();let Q=null;const k={init:s=>{Q=s},sortEntity:s=>[...s].sort((t,e)=>t.zIndex-e.zIndex||t.y-e.y),createImage:(s,t=[])=>{const e=new Image;return e.src=s,e.sprites=t,e},drawSprite:(s,t,e,i,n,o)=>{let r=s.sprites[t];Q.ctx.drawImage(s,r.x,r.y,n,o,e-r.w/2,i-r.h/2,r.w,r.h)},drawAnimatedSprite:(s,t,e,i,n,o,r)=>{let a=s.sprites[t];Q.ctx.drawImage(s,a.frames[parseInt(e)],a.y,o,r,i-a.w/2,n-a.h/2,a.w,a.h)},playAudio:s=>{if(Q.stat("soundEnabled")){const t=new Audio(s);t.volume=.3,t.play().catch(()=>{})}}},Vt="/tower-defense/assets/laser-DtsNZ3_M.png",Gt="data:audio/mpeg;base64,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",g={playerLifes:10,coins:180,game:{soundEnabled:!0,showNormalDamage:!0},towers:{laser:{costs:80,color:"#ffff03",size:20,fireRange:110,damage:{from:3,to:4},coolDownTime:.6,baseCritRate:5,baseCritDamage:1.5,images:k.createImage(Vt,[{x:0,y:0,w:80,h:80},{x:0,y:160,w:80,h:80},{x:0,y:320,w:80,h:80},{x:0,y:480,w:80,h:80},{x:0,y:640,w:80,h:80},{x:0,y:800,w:80,h:80}]),audio:Gt,upgrades:[{cost:70,fireRange:120,damage:{from:6,to:8},color:"#2CE85B",critRate:2,critDamage:.1},{cost:180,fireRange:130,damage:{from:10,to:14},color:"#2CE8B9",critRate:3,critDamage:.2},{cost:250,fireRange:140,damage:{from:18,to:25},color:"#2A62DB",critRate:5,critDamage:.2}]}},mapGrid:80,leveling:{wavesPerLevel:10,healthFactor:1.4,speedFactor:1.05,rewardFactor:1.2,waveGeneration:{minThreat:15,maxThreat:100,threatFactor:1.2}},enemyTypes:{wisp:{graphic:"wisp",baseHealth:24,baseSpeed:50,baseReward:5,baseCritResistance:5,levelFactors:{health:1.6,speed:1.1,critResistanceFactor:1.1}},bug:{graphic:"bug",baseHealth:18,baseSpeed:90,baseReward:4,baseCritResistance:2,levelFactors:{health:1.5,speed:1.2,critResistanceFactor:1.1}},slime:{color:"#8A2BE2",baseHealth:100,baseSpeed:30,baseReward:10,baseCritResistance:0,levelFactors:{health:1.8,speed:1,critResistanceFactor:1.05}},scout:{color:"#FFD700",baseHealth:10,baseSpeed:160,baseReward:3,baseCritResistance:10,levelFactors:{health:1.3,speed:1.05,critResistanceFactor:1.2}},boss:{graphic:"wisp",color:"black",baseHealth:400,baseSpeed:40,baseReward:100,baseCritResistance:50,levelFactors:{health:2.5,speed:1.1,critResistanceFactor:1.4}}},waveFragments:{line_of_wisps:{threat:15,details:{enemyType:"wisp",count:5,spacing:2,countFactor:1}},lone_slime:{threat:15,details:{enemyType:"slime",count:1,spacing:2,countFactor:1}},rush_of_bugs:{threat:25,details:{enemyType:"bug",count:4,spacing:2.5,countFactor:1.2}},pair_of_slimes:{threat:20,details:{enemyType:"slime",count:2,spacing:3,countFactor:1.2}},scout_rush:{threat:30,details:{enemyType:"scout",count:6,spacing:2,countFactor:2}},mixed_pair:{threat:45,details:[{enemyType:"wisp",count:5,spacing:2,countFactor:1.5},{enemyType:"bug",count:5,spacing:3,countFactor:1.5}]}},fillUpFragments:{fill_up_wisps:{threat:4,details:{enemyType:"wisp",count:2,spacing:2,countFactor:1.1}},fill_up_bugs:{threat:5,details:{enemyType:"bug",count:2,spacing:2.5,countFactor:1.2}},fill_up_scouts:{threat:6,details:{enemyType:"scout",count:3,spacing:3,countFactor:1.6}}},bossWaveTemplate:[{enemyType:"boss",count:1,spacing:0}]};class zt{constructor(t){this.game=t,this.panel=null}init(){this.panel=document.createElement("div"),this.panel.style.position="absolute",this.panel.style.top="10px",this.panel.style.right="10px",this.panel.style.width="300px",this.panel.style.maxHeight="90vh",this.panel.style.overflowY="auto",this.panel.style.background="rgba(0,0,0,0.75)",this.panel.style.color="white",this.panel.style.padding="10px",this.panel.style.fontFamily="monospace",this.panel.style.fontSize="12px",this.panel.style.zIndex="1000",document.body.appendChild(this.panel),this.game.on("update",()=>this.update())}update(){if(!this.panel)return;const t=Object.values(this.game.mapEntities.list).filter(a=>a.type==="tower"),e=this.game.enemies.enemiesList,i=t.map(a=>`<li>LvL ${a.level+1} ${a.bullet} (${a.stats.kills} kills, ${a.stats.crits} crits)</li>`).join(""),n=e.map(a=>`<li>LvL ${a.level} ${a.enemyType} | HP: ${Math.round(a.health)}/${Math.round(a.maxHealth)}</li>`).join(""),r=(this.game.lastWaveTemplate||[]).map(a=>`<li>${a.name} - ${a.count}x Lvl ${a.level} ${a.enemyType} (${a.threat})</li>`).join("");this.panel.innerHTML=`
            <h3>Debug Info</h3>
            <p><strong>Game Mode:</strong> ${this.game.stat("mode")||"normal"}</p>
            <p><strong>Wave:</strong> ${this.game.stat("wave")}</p>
            <p><strong>Game Level:</strong> ${Math.floor(((this.game.waveCounter||1)-1)/g.leveling.wavesPerLevel)+1}</p>
            <p><strong>Wave Threat:</strong> ${Math.round(this.game.lastWaveCurrentThreat||0)} / ${Math.round(this.game.lastWaveMaxThreat||0)}</p>
            <hr>
            <h4>Towers (${t.length})</h4>
            <ul>${i||"<li>None</li>"}</ul>
            <hr>
            <h4>Enemies (${e.length})</h4>
            <ul>${n||"<li>None</li>"}</ul>
            <hr>
            <h4>Last Wave Composition</h4>
            <ul>${r||"<li>N/A</li>"}</ul>
        `}}const Kt="/tower-defense/assets/backlayer-CBCCWrSs.png",jt="/tower-defense/assets/frontlayer-BiJAsHOn.png";class Qt{constructor(t,e){this.game=t,this.mapEntities=e,this.waypoints=[{x:0,y:120},{x:120,y:120},{x:120,y:360},{x:360,y:360},{x:360,y:200},{x:520,y:200},{x:520,y:520},{x:680,y:520},{x:680,y:280},{x:800,y:280},{x:920,y:280},{x:920,y:200},{x:1200,y:200}],this.images={background:k.createImage(Kt),frontLayer:k.createImage(jt)},this.game.on("update",()=>this.update()),this.game.on("beforeDraw",()=>this.beforeDraw()),this.game.on("afterDraw",()=>this.afterDraw())}update(){}beforeDraw(){this.game.ctx.drawImage(this.images.background,0,0,this.game.canvas.width,this.game.canvas.height),this.grid(g.mapGrid)}afterDraw(){this.game.ctx.drawImage(this.images.frontLayer,0,0,this.game.canvas.width,this.game.canvas.height)}isValidTowerPlace(t,e){const i=this.distanceToPath(t,e);return i<=g.mapGrid/2||this.isTowerAtPosition(t,e)?!1:i<=Math.sqrt(2)*g.mapGrid}distanceToPath(t,e){let i=1/0;for(let n=0;n<this.waypoints.length-1;n++){const o=this.waypoints[n].x,r=this.waypoints[n].y,a=this.waypoints[n+1].x,l=this.waypoints[n+1].y,c=a-o,d=l-r,h=c*c+d*d;let u;if(h===0)u=this.game.distance(t,e,o,r);else{let y=((t-o)*c+(e-r)*d)/h;y=Math.max(0,Math.min(1,y));const p=o+y*c,m=r+y*d;u=this.game.distance(t,e,p,m)}i=Math.min(i,u)}return i}isTowerAtPosition(t,e){for(let i in this.mapEntities.list){let n=this.mapEntities.list[i];if(n.type==="tower"&&n.x===t&&n.y===e)return!0}return!1}grid(t){this.game.ctx.beginPath(),this.game.ctx.strokeStyle="#ffffff22",this.game.ctx.lineWidth=1;for(let e=t;e<this.game.canvas.height;e+=t)this.game.ctx.moveTo(0,e),this.game.ctx.lineTo(this.game.canvas.width,e);for(let e=t;e<this.game.canvas.width;e+=t)this.game.ctx.moveTo(e,0),this.game.ctx.lineTo(e,this.game.canvas.height);this.game.ctx.stroke()}}class Wt{constructor(t){this.game=t,this.list={},this.idCounter=0,this.game.on("update",e=>this.update(e)),this.game.on("beforeDraw",()=>this.draw())}add(t){const e=++this.idCounter;return t.id=e,this.list[e]=t,t}remove(t){this.list[t]&&delete this.list[t]}update(t){const e=Object.keys(this.list);for(const i of e){const n=this.list[i];n&&n.update(t)}}draw(){for(const t in this.list)this.game.drawList.push(this.list[t])}}class Yt{constructor(t){this.game=t,this.x=0,this.y=0,this.clicked=!1,this.game.canvas.addEventListener("mousemove",e=>this.onMove(e)),this.game.canvas.addEventListener("click",e=>this.onClick(e))}update(){this.clicked=!1}onMove(t){this.x=t.offsetX,this.y=t.offsetY}onClick(t){this.clicked=!0}isMouseOver(t,e,i){return Math.round(Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-e,2)))<=i}}class et{constructor(t,e,i,n,o){this.game=t,this.type="entity",this.x=e,this.y=i,this.r=n,this.color=o,this.zIndex=0}update(t){}draw(){this.game.drawCircle(this.x,this.y,this.r,this.color,!0)}remove(){this.game.mapEntities.remove(this.id)}}class Ut extends et{constructor(t,e){super(e,0,0,0,"transparent"),this.target=t,this.type="healthbar",this.zIndex=15}update(){if(this.target.deleted){this.game.mapEntities.remove(this.id);return}this.x=this.target.x,this.y=this.target.y}draw(){const t=this.target.health/this.target.maxHealth;if(t<1){const e={x:this.x-this.target.r,y:this.y-this.target.r-8,width:this.target.r*2,height:4};this.game.ctx.fillStyle="black",this.game.ctx.fillRect(e.x,e.y,e.width,e.height),this.game.ctx.fillStyle="green",this.game.ctx.fillRect(e.x,e.y,e.width*t,e.height)}}}class Zt extends et{constructor(t,e,i,n,o,r){super(r,e,i,0,"transparent"),this.text=t,this.isCrit=n,this.floatDirection=o||-1,this.type="damagenumber",this.zIndex=20,this.lifetime=1,this.opacity=1,this.verticalSpeed=30}update(t){if(this.lifetime-=t,this.lifetime<=0){this.game.mapEntities.remove(this.id);return}this.y+=this.verticalSpeed*this.floatDirection*t,this.opacity=this.lifetime}draw(){const t=this.game.ctx;t.save(),t.font=this.isCrit?"bold 18px sans-serif":"normal 14px sans-serif",t.textAlign="center",t.strokeStyle=`rgba(0, 0, 0, ${this.opacity})`,t.lineWidth=3,t.strokeText(this.text,this.x,this.y),t.fillStyle=this.isCrit?`rgba(255, 0, 0, ${this.opacity})`:`rgba(255, 255, 255, ${this.opacity})`,t.fillText(this.text,this.x,this.y),t.restore()}}const qt="/tower-defense/assets/wisp-DEJtt0a3.png",Jt="/tower-defense/assets/bug-C3HbAPzA.png";class Xt extends et{constructor(t,e,i,n){var y,p,m,O;const o=g.enemyTypes[t];if(!o){console.error(`Enemy type "${t}" not found in settings.enemyTypes`);return}const r=o.color||"red";super(n.game,0,0,10,r),this.enemiesController=n,this.type="enemy",this.enemyType=t;const a=e>0?e-1:0,l=((y=o.levelFactors)==null?void 0:y.health)??g.leveling.healthFactor,c=((p=o.levelFactors)==null?void 0:p.speed)??g.leveling.speedFactor,d=((m=o.levelFactors)==null?void 0:m.reward)??g.leveling.rewardFactor,h=((O=o.levelFactors)==null?void 0:O.critResistanceFactor)??1.1;this.health=o.baseHealth*Math.pow(l,a),this.maxHealth=this.health,this.speed=o.baseSpeed*Math.pow(c,a),this.reward=Math.round(o.baseReward*Math.pow(d,a)),this.critResistance=o.baseCritResistance*Math.pow(h,a),this.graphicType=o.graphic,this.level=e,this.wave=i;const u=Math.round(Math.random()*40)-10;this.waypointIndex=0,this.waypoint={},this.shift=u,this.velocity={x:0,y:0},this.direction=0,this.frame=0,this.deleted=!1,this.zIndex=5,this.enemiesController.mapEntities.add(this),this.enemiesController.mapEntities.add(new Ut(this,this.enemiesController.game)),this.nextWaypoint()}nextWaypoint(){const t=this.enemiesController.map;this.waypoint.x||(this.waypoint={...t.waypoints[this.waypointIndex]},this.waypoint.x+=this.shift,this.waypoint.y+=this.shift,this.x=this.waypoint.x,this.y=this.waypoint.y);let e=this.waypoint.x,i=this.waypoint.y;return this.waypointIndex++,t.waypoints[this.waypointIndex]?(this.waypoint={...t.waypoints[this.waypointIndex]},this.waypoint.x+=this.shift,this.waypoint.y+=this.shift,this.velocity.x=this.x<this.waypoint.x?this.speed:-this.speed,e===this.waypoint.x&&(this.velocity.x=0),this.velocity.y=this.y<this.waypoint.y?this.speed:-this.speed,i===this.waypoint.y&&(this.velocity.y=0),this.velocity.y<0?this.direction=0:this.velocity.x>0?this.direction=1:this.velocity.y>0?this.direction=2:this.velocity.x<0&&(this.direction=3),!0):(this.done(),!1)}waypointReached(){return this.velocity.x>0&&this.x>=this.waypoint.x||this.velocity.x<0&&this.x<=this.waypoint.x||this.velocity.y>0&&this.y>=this.waypoint.y||this.velocity.y<0&&this.y<=this.waypoint.y}update(t){if(!this.deleted&&(this.waypointReached()?this.nextWaypoint():(this.x+=this.velocity.x*t,this.y+=this.velocity.y*t),this.graphicType)){const e=this.enemiesController.images[this.graphicType].sprites[this.direction];e.frames&&(this.frame=(this.frame+6*t)%e.frames.length)}}draw(){this.graphicType?k.drawAnimatedSprite(this.enemiesController.images[this.graphicType],this.direction,this.frame,Math.round(this.x),Math.round(this.y),40,40):this.enemiesController.game.drawCircle(this.x,this.y,this.r,this.color,!0)}damage(t,e=!1){if(!this.deleted){if(e||this.enemiesController.game.stat("showNormalDamage")){const i=this.velocity.y<0?1:-1;this.enemiesController.mapEntities.add(new Zt(t,this.x,this.y-this.r,e,i,this.enemiesController.game))}this.health-=t,this.health<=0&&this.die()}}die(){this.deleted||(this.health=0,this.deleted=!0,this.game.stat("coins",this.game.stat("coins")+this.reward,!0),this.enemiesController.remove(this))}done(){if(this.deleted)return;this.deleted=!0;let t=this.game.stat("life")-1;t<=0?this.game.setGameOver():this.game.stat("life",t,!0),this.enemiesController.remove(this)}}class te{constructor(t,e,i){this.game=t,this.map=e,this.mapEntities=i,this.images={wisp:k.createImage(qt,[{x:0,y:0,w:20,h:20,frames:[0,40,80,120,160,200]},{x:0,y:40,w:20,h:20,frames:[0,40,80,120,160,200]},{x:0,y:80,w:20,h:20,frames:[0,40,80,120,160,200]},{x:0,y:120,w:20,h:20,frames:[0,40,80,120,160,200]}]),bug:k.createImage(Jt,[{x:0,y:0,w:20,h:20,frames:[0]},{x:40,y:0,w:20,h:20,frames:[40]},{x:80,y:0,w:20,h:20,frames:[80]},{x:120,y:0,w:20,h:20,frames:[120]}])},this.enemiesList=[]}create(t,e,i){const n=new Xt(t,e,i,this);return this.enemiesList.push(n),n}remove(t){if(!t)return;const e=this.enemiesList.indexOf(t);e>-1&&this.enemiesList.splice(e,1),this.mapEntities.remove(t.id)}}class ee extends et{constructor(t,e,i,n){const o=g.towers[i];super(n.game,t,e,o.size,o.color),this.towersController=n,this.type="tower",this.bullet=i,this.fireRange=o.fireRange,this.damage=o.damage,this.cooldownTime=o.coolDownTime,this.level=0,this.audio=o.audio,this.critRate=o.baseCritRate,this.critDamage=o.baseCritDamage,this.stats={shoots:0,dmg:0,kills:0,crits:0},this.cooldownCounter=0,this.targetEnemy=null,this.targetingPriority=["most-advanced"],this.towersController.mapEntities.add(this)}upgrade(){const t=this.towersController.game,e=t.stat("coins"),i=g.towers[this.bullet].upgrades[this.level];i&&e>=i.cost&&(t.stat("coins",e-i.cost,!0),this.damage=i.damage,this.fireRange=i.fireRange,this.critRate+=i.critRate,this.critDamage+=i.critDamage,this.level++,this.color=i.color,t.modal.close())}update(t){const{game:e,mouse:i}=this.towersController;this.cooldownCounter+=t,this.targetEnemy&&(e.distance(this.x,this.y,this.targetEnemy.x,this.targetEnemy.y)>=this.fireRange+this.targetEnemy.r||this.targetEnemy.health<=0)&&(this.targetEnemy=null),this.targetEnemy||(this.targetEnemy=this.findTargetEnemy()),this.targetEnemy&&this.cooldownCounter>=this.cooldownTime&&(this.shoot(this.targetEnemy),k.playAudio(this.audio),this.cooldownCounter=0),this.zIndex=i.isMouseOver(this.x,this.y,this.r)?20:10,e.stat("mode")!=="dropTower"&&i.clicked&&i.isMouseOver(this.x,this.y,this.r)&&this.towersController.openOptions(this)}getEnemiesInRange(){const{game:t,enemies:e}=this.towersController;return e.enemiesList.filter(i=>t.distance(this.x,this.y,i.x,i.y)<=this.fireRange+i.r)}compareByStrategy(t,e,i){const{game:n}=this.towersController;switch(i){case"most-advanced":if(e.waypointIndex!==t.waypointIndex)return e.waypointIndex-t.waypointIndex;const o=t.waypoint?n.distance(t.x,t.y,t.waypoint.x,t.waypoint.y):1/0,r=e.waypoint?n.distance(e.x,e.y,e.waypoint.x,e.waypoint.y):1/0;return o-r;case"least-health":return t.health-e.health;case"most-health":return e.health-t.health;case"fastest":return e.speed-t.speed;case"slowest":return t.speed-e.speed;case"closest":const a=n.distance(this.x,this.y,t.x,t.y),l=n.distance(this.x,this.y,e.x,e.y);return a-l;case"prioritize-boss":const c=t.enemyType==="boss",d=e.enemyType==="boss";return c&&!d?-1:!c&&d?1:0;case"prioritize-normal":const h=t.enemyType!=="boss",u=e.enemyType!=="boss";return h&&!u?-1:!h&&u?1:0;default:return 0}}findTargetEnemy(){const t=this.getEnemiesInRange();return t.length===0?null:t.length===1?t[0]:[...t].sort((i,n)=>{for(const o of this.targetingPriority){const r=this.compareByStrategy(i,n,o);if(r!==0)return r}return 0})[0]}shoot(t){let e=Math.floor(Math.random()*(this.damage.to-this.damage.from+1))+this.damage.from,i=!1;const n=(this.critRate-t.critResistance)/100,o=Math.max(.05,Math.min(n,.75));Math.random()<o&&(e*=this.critDamage,this.stats.crits++,i=!0),e=Math.round(e),this.stats.shoots++,this.stats.dmg+=e,t.damage(e,i),t.deleted&&this.stats.kills++,this.cooldownCounter=this.cooldownTime,this.shootingAt=t,setTimeout(()=>{this.shootingAt=null},100)}draw(){const{game:t,mouse:e}=this.towersController;e.isMouseOver(this.x,this.y,this.r)&&t.stat("mode")!=="dropTower"&&t.drawCircle(this.x,this.y,this.fireRange,"rgba(0,0,255,0.2)",!0),k.drawSprite(g.towers[this.bullet].images,this.level,this.x,this.y-20,160,160),this.shootingAt&&(t.ctx.save(),t.ctx.beginPath(),t.ctx.strokeStyle=this.color,t.ctx.lineWidth=2,t.ctx.moveTo(this.x,this.y-50),t.ctx.lineTo(this.shootingAt.x,this.shootingAt.y),t.ctx.stroke(),t.ctx.restore())}}class se{constructor(t,e,i,n,o){this.game=t,this.map=e,this.mouse=i,this.mapEntities=n,this.enemies=o,this.game.on("update",()=>this.update()),this.game.on("beforeDraw",()=>this.draw())}update(){const t=this.gridPosition(),e=this.game.stat("selectedTowerType");this.game.stat("mode")==="dropTower"&&this.map.isValidTowerPlace(t.x,t.y)&&this.mouse.clicked&&(this.game.stat("mode",""),this.game.stat("coins",this.game.stat("coins")-g.towers[e].costs,!0),this.create(t.x,t.y,e))}draw(){if(this.game.stat("mode")==="dropTower"){const t=this.gridPosition(),e=this.game.stat("selectedTowerType"),i=this.map.isValidTowerPlace(t.x,t.y),n=this.map.isTowerAtPosition(t.x,t.y);i?(this.game.drawCircle(t.x,t.y,g.towers[e].fireRange,"rgba(0,0,255,0.2)",!0),k.drawSprite(g.towers[e].images,0,t.x,t.y-20,160,160)):n||(this.game.ctx.save(),this.game.ctx.filter="grayscale(100%)",k.drawSprite(g.towers[e].images,0,t.x,t.y-20,160,160),this.game.ctx.restore())}}create(t,e,i){return new ee(t,e,i,this)}gridPosition(){const t=Math.floor(this.mouse.x/g.mapGrid)*g.mapGrid+g.mapGrid/2,e=Math.floor(this.mouse.y/g.mapGrid)*g.mapGrid+g.mapGrid/2;return{x:t,y:e}}openOptions(t){let e=`
            <div id="tower-stats-container">
                <h4>Current Stats (Level ${t.level+1})</h4>
                <table class="tower-stats">
                    <tr><td>Schaden:</td><td>${t.damage.from} - ${t.damage.to}</td></tr>
                    <tr><td>Reichweite:</td><td>${t.fireRange}</td></tr>
                    <tr><td>Feuerrate:</td><td>${t.cooldownTime}s</td></tr>
                    <tr><td>Crit Chance:</td><td>${t.critRate.toFixed(0)}%</td></tr>
                    <tr><td>Crit Schaden:</td><td>${t.critDamage*100}%</td></tr>
                </table>
                <h4>Lifetime Stats</h4>
                <table class="tower-stats">
                    <tr><td>Schüsse:</td><td>${t.stats.shoots}</td></tr>
                    <tr><td>Crits:</td><td>${t.stats.crits} (${((t.stats.crits/t.stats.shoots||0)*100).toFixed(2)}%)</td></tr>
                    <tr><td>Kills:</td><td>${t.stats.kills}</td></tr>
                    <tr><td>Schaden:</td><td>${t.stats.dmg}</td></tr>
                </table>
                <h4>Zielpriorität</h4>
                <p style="font-size: 12px; margin-bottom: 8px;">Wähle mehrere Strategien. Bei Gleichstand wird die nächste Strategie als Tiebreaker verwendet.</p>
                <select id="tower-targeting-priority" multiple autocomplete="off">
                    <option value="most-advanced">Am weitesten fortgeschritten</option>
                    <option value="least-health">Wenigsten Leben</option>
                    <option value="most-health">Meisten Leben</option>
                    <option value="fastest">Am schnellsten</option>
                    <option value="slowest">Am langsamsten</option>
                    <option value="closest">Am nächsten</option>
                    <option value="prioritize-boss">Bosse bevorzugen</option>
                    <option value="prioritize-normal">Normale Gegner bevorzugen</option>
                </select>
            </div>
            <div id="tower-upgrade-container">
        `;const i=g.towers[t.bullet].upgrades[t.level];i?e+=`
                <h4>Upgrade auf Level ${t.level+2}</h4>
                <table class="tower-stats">
                    <tr><td>Kosten:</td><td>${i.cost} Coins</td></tr>
                    <tr><td>Schaden:</td><td>${i.damage.from} - ${i.damage.to}</td></tr>
                    <tr><td>Reichweite:</td><td>${i.fireRange}</td></tr>
                    <tr><td>Crit Chance:</td><td>+${i.critRate}%</td></tr>
                    <tr><td>Crit Schaden:</td><td>+${i.critDamage*100}%</td></tr>
                </table>
                <button id="tower-buy-upgrade-btn" class="btn">Upgrade Kaufen</button>
            `:e+="<h4>Max Level</h4>",e+="</div>",this.game.modal.open("Tower Options",e);const n=new window.TomSelect("#tower-targeting-priority",{plugins:["drag_drop","remove_button"],persist:!1,maxItems:null,items:t.targetingPriority,onItemAdd:function(){t.targetingPriority=this.items},onItemRemove:function(){t.targetingPriority=this.items},onDropdownClose:function(){t.targetingPriority=this.items}});if(this.game.modal.onClose(()=>{n.destroy()}),i){const o=document.getElementById("tower-buy-upgrade-btn");if(o){o.onclick=()=>t.upgrade();const r=()=>{o.disabled=i.cost>this.game.stat("coins")};r();const a=()=>r();this.game.on("stat:coins",a),this.game.modal.onClose(()=>{this.game.off("stat:coins",a)})}}}}const ie="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='%23ffffff'%20d='m2.344%2015.271l2%203.46a1%201%200%200%200%201.366.365l1.396-.806c.58.457%201.221.832%201.895%201.112V21a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1.598a8%208%200%200%200%201.895-1.112l1.396.806c.477.275%201.091.11%201.366-.365l2-3.46a1.004%201.004%200%200%200-.365-1.366l-1.372-.793a7.7%207.7%200%200%200-.002-2.224l1.372-.793c.476-.275.641-.89.365-1.366l-2-3.46a1%201%200%200%200-1.366-.365l-1.396.806A8%208%200%200%200%2015%204.598V3a1%201%200%200%200-1-1h-4a1%201%200%200%200-1%201v1.598A8%208%200%200%200%207.105%205.71L5.71%204.904a1%201%200%200%200-1.366.365l-2%203.46a1.004%201.004%200%200%200%20.365%201.366l1.372.793a7.7%207.7%200%200%200%200%202.224l-1.372.793c-.476.275-.641.89-.365%201.366M12%208c2.206%200%204%201.794%204%204s-1.794%204-4%204s-4-1.794-4-4s1.794-4%204-4'/%3e%3c/svg%3e";class ne{constructor(){this.containerElement=null,this.modalElement=null,this.titleElement=null,this.contentElement=null,this.closeButton=null,this.isOpen=!1,this.cleanupCallbacks=[],this.init()}init(){var t,e,i,n,o;if(this.containerElement=document.querySelector(".modal"),this.modalElement=(t=this.containerElement)==null?void 0:t.querySelector(".modal-content"),this.titleElement=(e=this.modalElement)==null?void 0:e.querySelector(".modal-title"),this.contentElement=(i=this.modalElement)==null?void 0:i.querySelector(".modal-body"),this.closeButton=(n=this.modalElement)==null?void 0:n.querySelector(".modal-close"),!this.containerElement||!this.modalElement){console.error("Modal elements not found in DOM");return}(o=this.closeButton)==null||o.addEventListener("click",()=>this.close()),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.isOpen&&this.close()}),this.handleOutsideClick=this.handleOutsideClick.bind(this)}handleOutsideClick(t){t.target.closest(".modal-content")||(t.stopPropagation(),this.close())}open(t,e){this.containerElement&&(this.isOpen||(this.setTitle(t),this.setContent(e),this.preventBodyScroll(),this.containerElement.classList.add("is--open"),this.isOpen=!0,requestAnimationFrame(()=>{document.addEventListener("click",this.handleOutsideClick)})))}preventBodyScroll(){const t=window.innerWidth-document.documentElement.clientWidth;t>0&&(document.body.style.paddingRight=`${t}px`),document.body.style.overflow="hidden"}restoreBodyScroll(){document.body.style.overflow="",document.body.style.paddingRight=""}close(){this.containerElement&&(this.containerElement.classList.remove("is--open"),this.isOpen=!1,this.restoreBodyScroll(),document.removeEventListener("click",this.handleOutsideClick),this.cleanupCallbacks.forEach(t=>t()),this.cleanupCallbacks=[],this.setContent(""))}onClose(t){typeof t=="function"&&this.cleanupCallbacks.push(t)}setTitle(t){this.titleElement&&(this.titleElement.innerHTML=t)}setContent(t){this.contentElement&&(typeof t=="string"?this.contentElement.innerHTML=t:t instanceof HTMLElement&&(this.contentElement.innerHTML="",this.contentElement.appendChild(t)))}}class re{constructor(){k.init(this),this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.drawList=[],this.stats={},this._outputCache={},this.waveCounter=0,this.gameOver=!1,this.eventsList={},this.lastFrameTime=0,this.lastWaveTemplate=[],this.optionsIconImage=new Image,this.optionsIconImage.src=ie,this.optionsIconPos={x:this.canvas.width-40,y:10,width:30,height:30},this.mapEntities=new Wt(this),this.map=new Qt(this,this.mapEntities),this.mouse=new Yt(this),this.enemies=new te(this,this.map,this.mapEntities),this.towers=new se(this,this.map,this.mouse,this.mapEntities,this.enemies),this.debug=new zt(this),this.modal=new ne,this.stat("soundEnabled",g.game.soundEnabled),this.stat("showNormalDamage",g.game.showNormalDamage),this.loadSettings(),document.addEventListener("click",t=>{if(this.gameOver){this.resetGame();return}t.target.matches("#buy-tower")&&(t.preventDefault(),this.buyTower("laser")),t.target.matches("#next-wave")&&(t.preventDefault(),this.nextWave())},!1),this.canvas.addEventListener("click",t=>{const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;i>=this.optionsIconPos.x&&i<=this.optionsIconPos.x+this.optionsIconPos.width&&n>=this.optionsIconPos.y&&n<=this.optionsIconPos.y+this.optionsIconPos.height&&this.openSettingsModal()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.stat("mode")==="dropTower"&&this.stat("mode","")}),this.output("#towerCosts",g.towers.laser.costs),this.output("#app-version","v0.0.2alpha"),this.resetGame(),window.requestAnimationFrame(this.draw.bind(this))}loadSettings(){const t=JSON.parse(localStorage.getItem("gameSettings"))||{};this.stat("soundEnabled",t.soundEnabled??g.game.soundEnabled),this.stat("showNormalDamage",t.showNormalDamage??g.game.showNormalDamage)}saveSettings(){const t={soundEnabled:this.stat("soundEnabled"),showNormalDamage:this.stat("showNormalDamage")};localStorage.setItem("gameSettings",JSON.stringify(t))}openSettingsModal(){const t=`
            <div>
                <label>
                    <input type="checkbox" id="setting-sound-enabled" ${this.stat("soundEnabled")?"checked":""}>
                    Sound aktivieren
                </label>
            </div>
            <div>
                <label>
                    <input type="checkbox" id="setting-show-normal-damage" ${this.stat("showNormalDamage")?"checked":""}>
                    Normale Schadenszahlen anzeigen (Crits immer anzeigen)
                </label>
            </div>
        `;this.modal.open("Settings",t),document.getElementById("setting-sound-enabled").addEventListener("change",e=>{this.stat("soundEnabled",e.target.checked),this.saveSettings()}),document.getElementById("setting-show-normal-damage").addEventListener("change",e=>{this.stat("showNormalDamage",e.target.checked),this.saveSettings()})}resetGame(){this.gameOver=!1,this.waveCounter=0,this.mapEntities.list={},this.enemies.enemiesList=[],this.stat("life",g.playerLifes,!0),this.stat("coins",g.coins,!0),this.stat("wave",0,!0),this.stat("mode","")}buyTower(t){this.stat("mode")!=="dropTower"&&this.stat("coins")>=g.towers[t].costs&&(this.stat("mode","dropTower"),this.stat("selectedTowerType",t))}update(t){if(this.gameOver){this.mouse.update();return}this.trigger("update",t),this.mouse.update()}draw(t){t||(t=0);const e=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t,window.requestAnimationFrame(this.draw.bind(this)),this.update(e),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.trigger("beforeDraw"),this.drawList=k.sortEntity(this.drawList);for(const i of this.drawList)i.draw();this.drawList=[],this.trigger("afterDraw"),this.optionsIconImage.complete&&this.ctx.drawImage(this.optionsIconImage,this.optionsIconPos.x,this.optionsIconPos.y,this.optionsIconPos.width,this.optionsIconPos.height),this.gameOver&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="48px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("Game Over",this.canvas.width/2,this.canvas.height/2-40),this.ctx.font="24px sans-serif",this.ctx.fillText("Klicken zum Neustarten",this.canvas.width/2,this.canvas.height/2+20))}setGameOver(){this.gameOver=!0}stat(t,e,i){if(e===void 0)return this.stats[t]||!1;const n=this.stats[t];return this.stats[t]=e,i!==void 0&&this.output(`#${t}`,e),n!==e&&this.trigger(`stat:${t}`,e),this}output(t,e){this._outputCache[t]||(this._outputCache[t]=document.querySelectorAll(t)),this._outputCache[t]&&this._outputCache[t].forEach(i=>{i.innerHTML=e})}distance(t,e,i,n){let o=t-i,r=e-n;return Math.sqrt(o*o+r*r)}intersectRect(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}drawCircle(t,e,i,n,o=!0){this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),o===!0?(this.ctx.fillStyle=n,this.ctx.fill()):(this.ctx.strokeStyle=n,this.ctx.stroke())}nextWave(){if(Object.keys(this.mapEntities.list).length===0)return this;this.waveCounter++,this.stat("wave",this.waveCounter,!0);const t=Math.floor((this.waveCounter-1)/g.leveling.wavesPerLevel)+1,e=this.isBossWave()?this.generateBossWave(t):this.generateNormalWave(t);return this.lastWaveTemplate=e,this.spawnEnemiesFromTemplate(e),this}isBossWave(){return this.waveCounter>0&&this.waveCounter%g.leveling.wavesPerLevel===0}generateBossWave(t){return g.bossWaveTemplate.map(e=>({...e,level:t}))}generateNormalWave(t){const e=(this.waveCounter-1)%g.leveling.wavesPerLevel,i=Math.pow(e/(g.leveling.wavesPerLevel-1),1.7),{minThreat:n,maxThreat:o,threatFactor:r}=g.leveling.waveGeneration,a=Math.pow(r,t-1),l=n*a,c=o*a,d=l+(c-l)*i;let h=[],u=this.collectFragments(g.waveFragments,d,0,t,h);return u=this.collectFragments(g.fillUpFragments,d,u,t,h),this.lastWaveMaxThreat=d,this.lastWaveCurrentThreat=u,h}collectFragments(t,e,i,n,o){let r=0;const a=Object.keys(t);for(;r<100;){const l=a.filter(u=>t[u].threat<=e-i);if(l.length===0)break;const c=l[Math.floor(Math.random()*l.length)],d=t[c];let h=d.details;Array.isArray(h)||(h=[h]),h.forEach(u=>{o.push({...u,name:c,level:n,count:u.count+(n-1)*(u.countFactor||0),threat:d.threat})}),i+=d.threat,r++}return i}spawnEnemiesFromTemplate(t){let e=0;const i=20;t.forEach(n=>{var h;const o=g.enemyTypes[n.enemyType],r=((h=o.levelFactors)==null?void 0:h.speed)??g.leveling.speedFactor,a=n.level>0?n.level-1:0,l=o.baseSpeed*Math.pow(r,a),d=(n.spacing||1)*i/l*1e3;setTimeout(()=>{for(let u=0;u<n.count;u++)setTimeout(()=>{this.enemies.create(n.enemyType,n.level,this.waveCounter)},u*d)},e),e+=n.count*d})}on(t,e){return this.eventsList[t]||(this.eventsList[t]=[]),this.eventsList[t].push(e),this}off(t,e){if(!this.eventsList[t])return this;if(e){const i=this.eventsList[t].indexOf(e);i!==-1&&this.eventsList[t].splice(i,1)}else delete this.eventsList[t];return this}trigger(t,e){if(!this.eventsList[t])return this;for(let i=0;i<this.eventsList[t].length;i++)this.eventsList[t][i](e);return this}}function it(s,t){s.split(/\s+/).forEach(e=>{t(e)})}class oe{constructor(){this._events={}}on(t,e){it(t,i=>{const n=this._events[i]||[];n.push(e),this._events[i]=n})}off(t,e){var i=arguments.length;if(i===0){this._events={};return}it(t,n=>{if(i===1){delete this._events[n];return}const o=this._events[n];o!==void 0&&(o.splice(o.indexOf(e),1),this._events[n]=o)})}trigger(t,...e){var i=this;it(t,n=>{const o=i._events[n];o!==void 0&&o.forEach(r=>{r.apply(i,e)})})}}function ae(s){return s.plugins={},class extends s{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(t,e){s.plugins[t]={name:t,fn:e}}initializePlugins(t){var e,i;const n=this,o=[];if(Array.isArray(t))t.forEach(r=>{typeof r=="string"?o.push(r):(n.plugins.settings[r.name]=r.options,o.push(r.name))});else if(t)for(e in t)t.hasOwnProperty(e)&&(n.plugins.settings[e]=t[e],o.push(e));for(;i=o.shift();)n.require(i)}loadPlugin(t){var e=this,i=e.plugins,n=s.plugins[t];if(!s.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');i.requested[t]=!0,i.loaded[t]=n.fn.apply(e,[e.plugins.settings[t]||{}]),i.names.push(t)}require(t){var e=this,i=e.plugins;if(!e.plugins.loaded.hasOwnProperty(t)){if(i.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');e.loadPlugin(t)}return i.loaded[t]}}}const st=s=>(s=s.filter(Boolean),s.length<2?s[0]||"":ce(s)==1?"["+s.join("")+"]":"(?:"+s.join("|")+")"),Lt=s=>{if(!le(s))return s.join("");let t="",e=0;const i=()=>{e>1&&(t+="{"+e+"}")};return s.forEach((n,o)=>{if(n===s[o-1]){e++;return}i(),t+=n,e=1}),i(),t},Ft=s=>{let t=Array.from(s);return st(t)},le=s=>new Set(s).size!==s.length,G=s=>(s+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),ce=s=>s.reduce((t,e)=>Math.max(t,de(e)),0),de=s=>Array.from(s).length,kt=s=>{if(s.length===1)return[[s]];let t=[];const e=s.substring(1);return kt(e).forEach(function(n){let o=n.slice(0);o[0]=s.charAt(0)+o[0],t.push(o),o=n.slice(0),o.unshift(s.charAt(0)),t.push(o)}),t},he=[[0,65535]],ue="[̀-ͯ·ʾʼ]";let J,Mt;const pe=3,ht={},ut={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let s in ut){let t=ut[s]||"";for(let e=0;e<t.length;e++){let i=t.substring(e,e+1);ht[i]=s}}const fe=new RegExp(Object.keys(ht).join("|")+"|"+ue,"gu"),ge=s=>{J===void 0&&(J=we(he))},pt=(s,t="NFKD")=>s.normalize(t),X=s=>Array.from(s).reduce((t,e)=>t+me(e),""),me=s=>(s=pt(s).toLowerCase().replace(fe,t=>ht[t]||""),pt(s,"NFC"));function*ve(s){for(const[t,e]of s)for(let i=t;i<=e;i++){let n=String.fromCharCode(i),o=X(n);o!=n.toLowerCase()&&(o.length>pe||o.length!=0&&(yield{folded:o,composed:n,code_point:i}))}}const ye=s=>{const t={},e=(i,n)=>{const o=t[i]||new Set,r=new RegExp("^"+Ft(o)+"$","iu");n.match(r)||(o.add(G(n)),t[i]=o)};for(let i of ve(s))e(i.folded,i.folded),e(i.folded,i.composed);return t},we=s=>{const t=ye(s),e={};let i=[];for(let o in t){let r=t[o];r&&(e[o]=Ft(r)),o.length>1&&i.push(G(o))}i.sort((o,r)=>r.length-o.length);const n=st(i);return Mt=new RegExp("^"+n,"u"),e},Ae=(s,t=1)=>{let e=0;return s=s.map(i=>(J[i]&&(e+=i.length),J[i]||i)),e>=t?Lt(s):""},xe=(s,t=1)=>(t=Math.max(t,s.length-1),st(kt(s).map(e=>Ae(e,t)))),ft=(s,t=!0)=>{let e=s.length>1?1:0;return st(s.map(i=>{let n=[];const o=t?i.length():i.length()-1;for(let r=0;r<o;r++)n.push(xe(i.substrs[r]||"",e));return Lt(n)}))},be=(s,t)=>{for(const e of t){if(e.start!=s.start||e.end!=s.end||e.substrs.join("")!==s.substrs.join(""))continue;let i=s.parts;const n=r=>{for(const a of i){if(a.start===r.start&&a.substr===r.substr)return!1;if(!(r.length==1||a.length==1)&&(r.start<a.start&&r.end>a.start||a.start<r.start&&a.end>r.start))return!0}return!1};if(!(e.parts.filter(n).length>0))return!0}return!1};class tt{constructor(){B(this,"parts");B(this,"substrs");B(this,"start");B(this,"end");this.parts=[],this.substrs=[],this.start=0,this.end=0}add(t){t&&(this.parts.push(t),this.substrs.push(t.substr),this.start=Math.min(t.start,this.start),this.end=Math.max(t.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(t,e){let i=new tt,n=JSON.parse(JSON.stringify(this.parts)),o=n.pop();for(const l of n)i.add(l);let r=e.substr.substring(0,t-o.start),a=r.length;return i.add({start:o.start,end:o.start+a,length:a,substr:r}),i}}const Oe=s=>{ge(),s=X(s);let t="",e=[new tt];for(let i=0;i<s.length;i++){let o=s.substring(i).match(Mt);const r=s.substring(i,i+1),a=o?o[0]:null;let l=[],c=new Set;for(const d of e){const h=d.last();if(!h||h.length==1||h.end<=i)if(a){const u=a.length;d.add({start:i,end:i+u,length:u,substr:a}),c.add("1")}else d.add({start:i,end:i+1,length:1,substr:r}),c.add("2");else if(a){let u=d.clone(i,h);const y=a.length;u.add({start:i,end:i+y,length:y,substr:a}),l.push(u)}else c.add("3")}if(l.length>0){l=l.sort((d,h)=>d.length()-h.length());for(let d of l)be(d,e)||e.push(d);continue}if(i>0&&c.size==1&&!c.has("3")){t+=ft(e,!1);let d=new tt;const h=e[0];h&&d.add(h.last()),e=[d]}}return t+=ft(e,!0),t},Ce=(s,t)=>{if(s)return s[t]},_e=(s,t)=>{if(s){for(var e,i=t.split(".");(e=i.shift())&&(s=s[e]););return s}},nt=(s,t,e)=>{var i,n;return!s||(s=s+"",t.regex==null)||(n=s.search(t.regex),n===-1)?0:(i=t.string.length/s.length,n===0&&(i+=.5),i*e)},rt=(s,t)=>{var e=s[t];if(typeof e=="function")return e;e&&!Array.isArray(e)&&(s[t]=[e])},W=(s,t)=>{if(Array.isArray(s))s.forEach(t);else for(var e in s)s.hasOwnProperty(e)&&t(s[e],e)},Ee=(s,t)=>typeof s=="number"&&typeof t=="number"?s>t?1:s<t?-1:0:(s=X(s+"").toLowerCase(),t=X(t+"").toLowerCase(),s>t?1:t>s?-1:0);class Se{constructor(t,e){B(this,"items");B(this,"settings");this.items=t,this.settings=e||{diacritics:!0}}tokenize(t,e,i){if(!t||!t.length)return[];const n=[],o=t.split(/\s+/);var r;return i&&(r=new RegExp("^("+Object.keys(i).map(G).join("|")+"):(.*)$")),o.forEach(a=>{let l,c=null,d=null;r&&(l=a.match(r))&&(c=l[1],a=l[2]),a.length>0&&(this.settings.diacritics?d=Oe(a)||null:d=G(a),d&&e&&(d="\\b"+d)),n.push({string:a,regex:d?new RegExp(d,"iu"):null,field:c})}),n}getScoreFunction(t,e){var i=this.prepareSearch(t,e);return this._getScoreFunction(i)}_getScoreFunction(t){const e=t.tokens,i=e.length;if(!i)return function(){return 0};const n=t.options.fields,o=t.weights,r=n.length,a=t.getAttrFn;if(!r)return function(){return 1};const l=function(){return r===1?function(c,d){const h=n[0].field;return nt(a(d,h),c,o[h]||1)}:function(c,d){var h=0;if(c.field){const u=a(d,c.field);!c.regex&&u?h+=1/r:h+=nt(u,c,1)}else W(o,(u,y)=>{h+=nt(a(d,y),c,u)});return h/r}}();return i===1?function(c){return l(e[0],c)}:t.options.conjunction==="and"?function(c){var d,h=0;for(let u of e){if(d=l(u,c),d<=0)return 0;h+=d}return h/i}:function(c){var d=0;return W(e,h=>{d+=l(h,c)}),d/i}}getSortFunction(t,e){var i=this.prepareSearch(t,e);return this._getSortFunction(i)}_getSortFunction(t){var e,i=[];const n=this,o=t.options,r=!t.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof r=="function")return r.bind(this);const a=function(c,d){return c==="$score"?d.score:t.getAttrFn(n.items[d.id],c)};if(r)for(let c of r)(t.query||c.field!=="$score")&&i.push(c);if(t.query){e=!0;for(let c of i)if(c.field==="$score"){e=!1;break}e&&i.unshift({field:"$score",direction:"desc"})}else i=i.filter(c=>c.field!=="$score");return i.length?function(c,d){var h,u;for(let y of i)if(u=y.field,h=(y.direction==="desc"?-1:1)*Ee(a(u,c),a(u,d)),h)return h;return 0}:null}prepareSearch(t,e){const i={};var n=Object.assign({},e);if(rt(n,"sort"),rt(n,"sort_empty"),n.fields){rt(n,"fields");const o=[];n.fields.forEach(r=>{typeof r=="string"&&(r={field:r,weight:1}),o.push(r),i[r.field]="weight"in r?r.weight:1}),n.fields=o}return{options:n,query:t.toLowerCase().trim(),tokens:this.tokenize(t,n.respect_word_boundaries,i),total:0,items:[],weights:i,getAttrFn:n.nesting?_e:Ce}}search(t,e){var i=this,n,o;o=this.prepareSearch(t,e),e=o.options,t=o.query;const r=e.score||i._getScoreFunction(o);t.length?W(i.items,(l,c)=>{n=r(l),(e.filter===!1||n>0)&&o.items.push({score:n,id:c})}):W(i.items,(l,c)=>{o.items.push({score:1,id:c})});const a=i._getSortFunction(o);return a&&o.items.sort(a),o.total=o.items.length,typeof e.limit=="number"&&(o.items=o.items.slice(0,e.limit)),o}}const M=s=>typeof s>"u"||s===null?null:q(s),q=s=>typeof s=="boolean"?s?"1":"0":s+"",ot=s=>(s+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Ie=(s,t)=>t>0?window.setTimeout(s,t):(s.call(null),null),Te=(s,t)=>{var e;return function(i,n){var o=this;e&&(o.loading=Math.max(o.loading-1,0),clearTimeout(e)),e=setTimeout(function(){e=null,o.loadedSearches[i]=!0,s.call(o,i,n)},t)}},gt=(s,t,e)=>{var i,n=s.trigger,o={};s.trigger=function(){var r=arguments[0];if(t.indexOf(r)!==-1)o[r]=arguments;else return n.apply(s,arguments)},e.apply(s,[]),s.trigger=n;for(i of t)i in o&&n.apply(s,o[i])},Le=s=>({start:s.selectionStart||0,length:(s.selectionEnd||0)-(s.selectionStart||0)}),E=(s,t=!1)=>{s&&(s.preventDefault(),t&&s.stopPropagation())},T=(s,t,e,i)=>{s.addEventListener(t,e,i)},R=(s,t)=>{if(!t||!t[s])return!1;var e=(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0);return e===1},at=(s,t)=>{const e=s.getAttribute("id");return e||(s.setAttribute("id",t),t)},mt=s=>s.replace(/[\\"']/g,"\\$&"),N=(s,t)=>{t&&s.append(t)},S=(s,t)=>{if(Array.isArray(s))s.forEach(t);else for(var e in s)s.hasOwnProperty(e)&&t(s[e],e)},$=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(Pt(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},Pt=s=>typeof s=="string"&&s.indexOf("<")>-1,Fe=s=>s.replace(/['"\\]/g,"\\$&"),lt=(s,t)=>{var e=document.createEvent("HTMLEvents");e.initEvent(t,!0,!1),s.dispatchEvent(e)},Y=(s,t)=>{Object.assign(s.style,t)},F=(s,...t)=>{var e=$t(t);s=Dt(s),s.map(i=>{e.map(n=>{i.classList.add(n)})})},D=(s,...t)=>{var e=$t(t);s=Dt(s),s.map(i=>{e.map(n=>{i.classList.remove(n)})})},$t=s=>{var t=[];return S(s,e=>{typeof e=="string"&&(e=e.trim().split(/[\t\n\f\r\s]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},Dt=s=>(Array.isArray(s)||(s=[s]),s),ct=(s,t,e)=>{if(!(e&&!e.contains(s)))for(;s&&s.matches;){if(s.matches(t))return s;s=s.parentNode}},vt=(s,t=0)=>t>0?s[s.length-1]:s[0],ke=s=>Object.keys(s).length===0,yt=(s,t)=>{if(!s)return-1;t=t||s.nodeName;for(var e=0;s=s.previousElementSibling;)s.matches(t)&&e++;return e},C=(s,t)=>{S(t,(e,i)=>{e==null?s.removeAttribute(i):s.setAttribute(i,""+e)})},dt=(s,t)=>{s.parentNode&&s.parentNode.replaceChild(t,s)},Me=(s,t)=>{if(t===null)return;if(typeof t=="string"){if(!t.length)return;t=new RegExp(t,"i")}const e=o=>{var r=o.data.match(t);if(r&&o.data.length>0){var a=document.createElement("span");a.className="highlight";var l=o.splitText(r.index);l.splitText(r[0].length);var c=l.cloneNode(!0);return a.appendChild(c),dt(l,a),1}return 0},i=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(r=>{n(r)})},n=o=>o.nodeType===3?e(o):(i(o),0);n(s)},Pe=s=>{var t=s.querySelectorAll("span.highlight");Array.prototype.forEach.call(t,function(e){var i=e.parentNode;i.replaceChild(e.firstChild,e),i.normalize()})},$e=65,De=13,Be=27,Re=37,Ne=38,He=39,Ve=40,wt=8,Ge=46,At=9,ze=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),U=ze?"metaKey":"ctrlKey",xt={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(s){return s.length>0},render:{}};function bt(s,t){var e=Object.assign({},xt,t),i=e.dataAttr,n=e.labelField,o=e.valueField,r=e.disabledField,a=e.optgroupField,l=e.optgroupLabelField,c=e.optgroupValueField,d=s.tagName.toLowerCase(),h=s.getAttribute("placeholder")||s.getAttribute("data-placeholder");if(!h&&!e.allowEmptyOption){let m=s.querySelector('option[value=""]');m&&(h=m.textContent)}var u={placeholder:h,options:[],optgroups:[],items:[],maxItems:null},y=()=>{var m,O=u.options,x={},f=1;let _=0;var P=w=>{var A=Object.assign({},w.dataset),v=i&&A[i];return typeof v=="string"&&v.length&&(A=Object.assign(A,JSON.parse(v))),A},z=(w,A)=>{var v=M(w.value);if(v!=null&&!(!v&&!e.allowEmptyOption)){if(x.hasOwnProperty(v)){if(A){var I=x[v][a];I?Array.isArray(I)?I.push(A):x[v][a]=[I,A]:x[v][a]=A}}else{var b=P(w);b[n]=b[n]||w.textContent,b[o]=b[o]||v,b[r]=b[r]||w.disabled,b[a]=b[a]||A,b.$option=w,b.$order=b.$order||++_,x[v]=b,O.push(b)}w.selected&&u.items.push(v)}},H=w=>{var A,v;v=P(w),v[l]=v[l]||w.getAttribute("label")||"",v[c]=v[c]||f++,v[r]=v[r]||w.disabled,v.$order=v.$order||++_,u.optgroups.push(v),A=v[c],S(w.children,I=>{z(I,A)})};u.maxItems=s.hasAttribute("multiple")?null:1,S(s.children,w=>{m=w.tagName.toLowerCase(),m==="optgroup"?H(w):m==="option"&&z(w)})},p=()=>{const m=s.getAttribute(i);if(m)u.options=JSON.parse(m),S(u.options,x=>{u.items.push(x[o])});else{var O=s.value.trim()||"";if(!e.allowEmptyOption&&!O.length)return;const x=O.split(e.delimiter);S(x,f=>{const _={};_[n]=f,_[o]=f,u.options.push(_)}),u.items=x}};return d==="select"?y():p(),Object.assign({},xt,u,t)}var Ot=0;class L extends ae(oe){constructor(t,e){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Ot++;var i,n=$(t);if(n.tomselect)throw new Error("Tom Select already initialized on this element");n.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(n,null);i=o.getPropertyValue("direction");const r=bt(n,e);this.settings=r,this.input=n,this.tabIndex=n.tabIndex||0,this.is_select_tag=n.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(i),this.inputId=at(n,"tomselect-"+Ot),this.isRequired=n.required,this.sifter=new Se(this.options,{diacritics:r.diacritics}),r.mode=r.mode||(r.maxItems===1?"single":"multi"),typeof r.hideSelected!="boolean"&&(r.hideSelected=r.mode==="multi"),typeof r.hidePlaceholder!="boolean"&&(r.hidePlaceholder=r.mode!=="multi");var a=r.createFilter;typeof a!="function"&&(typeof a=="string"&&(a=new RegExp(a)),a instanceof RegExp?r.createFilter=O=>a.test(O):r.createFilter=O=>this.settings.duplicates||!this.options[O]),this.initializePlugins(r.plugins),this.setupCallbacks(),this.setupTemplates();const l=$("<div>"),c=$("<div>"),d=this._render("dropdown"),h=$('<div role="listbox" tabindex="-1">'),u=this.input.getAttribute("class")||"",y=r.mode;var p;if(F(l,r.wrapperClass,u,y),F(c,r.controlClass),N(l,c),F(d,r.dropdownClass,y),r.copyClassesToDropdown&&F(d,u),F(h,r.dropdownContentClass),N(d,h),$(r.dropdownParent||l).appendChild(d),Pt(r.controlInput)){p=$(r.controlInput);var m=["autocorrect","autocapitalize","autocomplete","spellcheck"];S(m,O=>{n.getAttribute(O)&&C(p,{[O]:n.getAttribute(O)})}),p.tabIndex=-1,c.appendChild(p),this.focus_node=p}else r.controlInput?(p=$(r.controlInput),this.focus_node=p):(p=$("<input/>"),this.focus_node=c);this.wrapper=l,this.dropdown=d,this.dropdown_content=h,this.control=c,this.control_input=p,this.setup()}setup(){const t=this,e=t.settings,i=t.control_input,n=t.dropdown,o=t.dropdown_content,r=t.wrapper,a=t.control,l=t.input,c=t.focus_node,d={passive:!0},h=t.inputId+"-ts-dropdown";C(o,{id:h}),C(c,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":h});const u=at(c,t.inputId+"-ts-control"),y="label[for='"+Fe(t.inputId)+"']",p=document.querySelector(y),m=t.focus.bind(t);if(p){T(p,"click",m),C(p,{for:u});const f=at(p,t.inputId+"-ts-label");C(c,{"aria-labelledby":f}),C(o,{"aria-labelledby":f})}if(r.style.width=l.style.width,t.plugins.names.length){const f="plugin-"+t.plugins.names.join(" plugin-");F([r,n],f)}(e.maxItems===null||e.maxItems>1)&&t.is_select_tag&&C(l,{multiple:"multiple"}),e.placeholder&&C(i,{placeholder:e.placeholder}),!e.splitOn&&e.delimiter&&(e.splitOn=new RegExp("\\s*"+G(e.delimiter)+"+\\s*")),e.load&&e.loadThrottle&&(e.load=Te(e.load,e.loadThrottle)),T(n,"mousemove",()=>{t.ignoreHover=!1}),T(n,"mouseenter",f=>{var _=ct(f.target,"[data-selectable]",n);_&&t.onOptionHover(f,_)},{capture:!0}),T(n,"click",f=>{const _=ct(f.target,"[data-selectable]");_&&(t.onOptionSelect(f,_),E(f,!0))}),T(a,"click",f=>{var _=ct(f.target,"[data-ts-item]",a);if(_&&t.onItemSelect(f,_)){E(f,!0);return}i.value==""&&(t.onClick(),E(f,!0))}),T(c,"keydown",f=>t.onKeyDown(f)),T(i,"keypress",f=>t.onKeyPress(f)),T(i,"input",f=>t.onInput(f)),T(c,"blur",f=>t.onBlur(f)),T(c,"focus",f=>t.onFocus(f)),T(i,"paste",f=>t.onPaste(f));const O=f=>{const _=f.composedPath()[0];if(!r.contains(_)&&!n.contains(_)){t.isFocused&&t.blur(),t.inputState();return}_==i&&t.isOpen?f.stopPropagation():E(f,!0)},x=()=>{t.isOpen&&t.positionDropdown()};T(document,"mousedown",O),T(window,"scroll",x,d),T(window,"resize",x,d),this._destroy=()=>{document.removeEventListener("mousedown",O),window.removeEventListener("scroll",x),window.removeEventListener("resize",x),p&&p.removeEventListener("click",m)},this.revertSettings={innerHTML:l.innerHTML,tabIndex:l.tabIndex},l.tabIndex=-1,l.insertAdjacentElement("afterend",t.wrapper),t.sync(!1),e.items=[],delete e.optgroups,delete e.options,T(l,"invalid",()=>{t.isValid&&(t.isValid=!1,t.isInvalid=!0,t.refreshState())}),t.updateOriginalInput(),t.refreshItems(),t.close(!1),t.inputState(),t.isSetup=!0,l.disabled?t.disable():l.readOnly?t.setReadOnly(!0):t.enable(),t.on("change",this.onChange),F(l,"tomselected","ts-hidden-accessible"),t.trigger("initialize"),e.preload===!0&&t.preload()}setupOptions(t=[],e=[]){this.addOptions(t),S(e,i=>{this.registerOptionGroup(i)})}setupTemplates(){var t=this,e=t.settings.labelField,i=t.settings.optgroupLabelField,n={optgroup:o=>{let r=document.createElement("div");return r.className="optgroup",r.appendChild(o.options),r},optgroup_header:(o,r)=>'<div class="optgroup-header">'+r(o[i])+"</div>",option:(o,r)=>"<div>"+r(o[e])+"</div>",item:(o,r)=>"<div>"+r(o[e])+"</div>",option_create:(o,r)=>'<div class="create">Add <strong>'+r(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};t.settings.render=Object.assign({},n,t.settings.render)}setupCallbacks(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in i)e=this.settings[i[t]],e&&this.on(t,e)}sync(t=!0){const e=this,i=t?bt(e.input,{delimiter:e.settings.delimiter}):e.settings;e.setupOptions(i.options,i.optgroups),e.setValue(i.items||[],!0),e.lastQuery=null}onClick(){var t=this;if(t.activeItems.length>0){t.clearActiveItems(),t.focus();return}t.isFocused&&t.isOpen?t.blur():t.focus()}onMouseDown(){}onChange(){lt(this.input,"input"),lt(this.input,"change")}onPaste(t){var e=this;if(e.isInputHidden||e.isLocked){E(t);return}e.settings.splitOn&&setTimeout(()=>{var i=e.inputValue();if(i.match(e.settings.splitOn)){var n=i.trim().split(e.settings.splitOn);S(n,o=>{M(o)&&(this.options[o]?e.addItem(o):e.createItem(o))})}},0)}onKeyPress(t){var e=this;if(e.isLocked){E(t);return}var i=String.fromCharCode(t.keyCode||t.which);if(e.settings.create&&e.settings.mode==="multi"&&i===e.settings.delimiter){e.createItem(),E(t);return}}onKeyDown(t){var e=this;if(e.ignoreHover=!0,e.isLocked){t.keyCode!==At&&E(t);return}switch(t.keyCode){case $e:if(R(U,t)&&e.control_input.value==""){E(t),e.selectAll();return}break;case Be:e.isOpen&&(E(t,!0),e.close()),e.clearActiveItems();return;case Ve:if(!e.isOpen&&e.hasOptions)e.open();else if(e.activeOption){let i=e.getAdjacent(e.activeOption,1);i&&e.setActiveOption(i)}E(t);return;case Ne:if(e.activeOption){let i=e.getAdjacent(e.activeOption,-1);i&&e.setActiveOption(i)}E(t);return;case De:e.canSelect(e.activeOption)?(e.onOptionSelect(t,e.activeOption),E(t)):(e.settings.create&&e.createItem()||document.activeElement==e.control_input&&e.isOpen)&&E(t);return;case Re:e.advanceSelection(-1,t);return;case He:e.advanceSelection(1,t);return;case At:e.settings.selectOnTab&&(e.canSelect(e.activeOption)&&(e.onOptionSelect(t,e.activeOption),E(t)),e.settings.create&&e.createItem()&&E(t));return;case wt:case Ge:e.deleteSelection(t);return}e.isInputHidden&&!R(U,t)&&E(t)}onInput(t){if(this.isLocked)return;const e=this.inputValue();if(this.lastValue!==e){if(this.lastValue=e,e==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=Ie(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const t=this.lastValue;this.settings.shouldLoad.call(this,t)&&this.load(t),this.refreshOptions(),this.trigger("type",t)}onOptionHover(t,e){this.ignoreHover||this.setActiveOption(e,!1)}onFocus(t){var e=this,i=e.isFocused;if(e.isDisabled||e.isReadOnly){e.blur(),E(t);return}e.ignoreFocus||(e.isFocused=!0,e.settings.preload==="focus"&&e.preload(),i||e.trigger("focus"),e.activeItems.length||(e.inputState(),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState())}onBlur(t){if(document.hasFocus()!==!1){var e=this;if(e.isFocused){e.isFocused=!1,e.ignoreFocus=!1;var i=()=>{e.close(),e.setActiveItem(),e.setCaret(e.items.length),e.trigger("blur")};e.settings.create&&e.settings.createOnBlur?e.createItem(null,i):i()}}}onOptionSelect(t,e){var i,n=this;e.parentElement&&e.parentElement.matches("[data-disabled]")||(e.classList.contains("create")?n.createItem(null,()=>{n.settings.closeAfterSelect&&n.close()}):(i=e.dataset.value,typeof i<"u"&&(n.lastQuery=null,n.addItem(i),n.settings.closeAfterSelect&&n.close(),!n.settings.hideSelected&&t.type&&/click/.test(t.type)&&n.setActiveOption(e))))}canSelect(t){return!!(this.isOpen&&t&&this.dropdown_content.contains(t))}onItemSelect(t,e){var i=this;return!i.isLocked&&i.settings.mode==="multi"?(E(t),i.setActiveItem(e,t),!0):!1}canLoad(t){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(t))}load(t){const e=this;if(!e.canLoad(t))return;F(e.wrapper,e.settings.loadingClass),e.loading++;const i=e.loadCallback.bind(e);e.settings.load.call(e,t,i)}loadCallback(t,e){const i=this;i.loading=Math.max(i.loading-1,0),i.lastQuery=null,i.clearActiveOption(),i.setupOptions(t,e),i.refreshOptions(i.isFocused&&!i.isInputHidden),i.loading||D(i.wrapper,i.settings.loadingClass),i.trigger("load",t,e)}preload(){var t=this.wrapper.classList;t.contains("preloaded")||(t.add("preloaded"),this.load(""))}setTextboxValue(t=""){var e=this.control_input,i=e.value!==t;i&&(e.value=t,lt(e,"update"),this.lastValue=t)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(t,e){var i=e?[]:["change"];gt(this,i,()=>{this.clear(e),this.addItems(t,e)})}setMaxItems(t){t===0&&(t=null),this.settings.maxItems=t,this.refreshState()}setActiveItem(t,e){var i=this,n,o,r,a,l,c;if(i.settings.mode!=="single"){if(!t){i.clearActiveItems(),i.isFocused&&i.inputState();return}if(n=e&&e.type.toLowerCase(),n==="click"&&R("shiftKey",e)&&i.activeItems.length){for(c=i.getLastActive(),r=Array.prototype.indexOf.call(i.control.children,c),a=Array.prototype.indexOf.call(i.control.children,t),r>a&&(l=r,r=a,a=l),o=r;o<=a;o++)t=i.control.children[o],i.activeItems.indexOf(t)===-1&&i.setActiveItemClass(t);E(e)}else n==="click"&&R(U,e)||n==="keydown"&&R("shiftKey",e)?t.classList.contains("active")?i.removeActiveItem(t):i.setActiveItemClass(t):(i.clearActiveItems(),i.setActiveItemClass(t));i.inputState(),i.isFocused||i.focus()}}setActiveItemClass(t){const e=this,i=e.control.querySelector(".last-active");i&&D(i,"last-active"),F(t,"active last-active"),e.trigger("item_select",t),e.activeItems.indexOf(t)==-1&&e.activeItems.push(t)}removeActiveItem(t){var e=this.activeItems.indexOf(t);this.activeItems.splice(e,1),D(t,"active")}clearActiveItems(){D(this.activeItems,"active"),this.activeItems=[]}setActiveOption(t,e=!0){t!==this.activeOption&&(this.clearActiveOption(),t&&(this.activeOption=t,C(this.focus_node,{"aria-activedescendant":t.getAttribute("id")}),C(t,{"aria-selected":"true"}),F(t,"active"),e&&this.scrollToOption(t)))}scrollToOption(t,e){if(!t)return;const i=this.dropdown_content,n=i.clientHeight,o=i.scrollTop||0,r=t.offsetHeight,a=t.getBoundingClientRect().top-i.getBoundingClientRect().top+o;a+r>n+o?this.scroll(a-n+r,e):a<o&&this.scroll(a,e)}scroll(t,e){const i=this.dropdown_content;e&&(i.style.scrollBehavior=e),i.scrollTop=t,i.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(D(this.activeOption,"active"),C(this.activeOption,{"aria-selected":null})),this.activeOption=null,C(this.focus_node,{"aria-activedescendant":null})}selectAll(){const t=this;if(t.settings.mode==="single")return;const e=t.controlChildren();e.length&&(t.inputState(),t.close(),t.activeItems=e,S(e,i=>{t.setActiveItemClass(i)}))}inputState(){var t=this;t.control.contains(t.control_input)&&(C(t.control_input,{placeholder:t.settings.placeholder}),t.activeItems.length>0||!t.isFocused&&t.settings.hidePlaceholder&&t.items.length>0?(t.setTextboxValue(),t.isInputHidden=!0):(t.settings.hidePlaceholder&&t.items.length>0&&C(t.control_input,{placeholder:""}),t.isInputHidden=!1),t.wrapper.classList.toggle("input-hidden",t.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var t=this;t.isDisabled||t.isReadOnly||(t.ignoreFocus=!0,t.control_input.offsetWidth?t.control_input.focus():t.focus_node.focus(),setTimeout(()=>{t.ignoreFocus=!1,t.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())}getSearchOptions(){var t=this.settings,e=t.sortField;return typeof t.sortField=="string"&&(e=[{field:t.sortField}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e,nesting:t.nesting}}search(t){var e,i,n=this,o=this.getSearchOptions();if(n.settings.score&&(i=n.settings.score.call(n,t),typeof i!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return t!==n.lastQuery?(n.lastQuery=t,e=n.sifter.search(t,Object.assign(o,{score:i})),n.currentResults=e):e=Object.assign({},n.currentResults),n.settings.hideSelected&&(e.items=e.items.filter(r=>{let a=M(r.id);return!(a&&n.items.indexOf(a)!==-1)})),e}refreshOptions(t=!0){var e,i,n,o,r,a,l,c,d,h;const u={},y=[];var p=this,m=p.inputValue();const O=m===p.lastQuery||m==""&&p.lastQuery==null;var x=p.search(m),f=null,_=p.settings.shouldOpen||!1,P=p.dropdown_content;O&&(f=p.activeOption,f&&(d=f.closest("[data-group]"))),o=x.items.length,typeof p.settings.maxOptions=="number"&&(o=Math.min(o,p.settings.maxOptions)),o>0&&(_=!0);const z=(w,A)=>{let v=u[w];if(v!==void 0){let b=y[v];if(b!==void 0)return[v,b.fragment]}let I=document.createDocumentFragment();return v=y.length,y.push({fragment:I,order:A,optgroup:w}),[v,I]};for(e=0;e<o;e++){let w=x.items[e];if(!w)continue;let A=w.id,v=p.options[A];if(v===void 0)continue;let I=q(A),b=p.getOption(I,!0);for(p.settings.hideSelected||b.classList.toggle("selected",p.items.includes(I)),r=v[p.settings.optgroupField]||"",a=Array.isArray(r)?r:[r],i=0,n=a&&a.length;i<n;i++){r=a[i];let K=v.$order,j=p.optgroups[r];j===void 0?r="":K=j.$order;const[Bt,Rt]=z(r,K);i>0&&(b=b.cloneNode(!0),C(b,{id:v.$id+"-clone-"+i,"aria-selected":null}),b.classList.add("ts-cloned"),D(b,"active"),p.activeOption&&p.activeOption.dataset.value==A&&d&&d.dataset.group===r.toString()&&(f=b)),Rt.appendChild(b),r!=""&&(u[r]=Bt)}}p.settings.lockOptgroupOrder&&y.sort((w,A)=>w.order-A.order),l=document.createDocumentFragment(),S(y,w=>{let A=w.fragment,v=w.optgroup;if(!A||!A.children.length)return;let I=p.optgroups[v];if(I!==void 0){let b=document.createDocumentFragment(),K=p.render("optgroup_header",I);N(b,K),N(b,A);let j=p.render("optgroup",{group:I,options:b});N(l,j)}else N(l,A)}),P.innerHTML="",N(P,l),p.settings.highlight&&(Pe(P),x.query.length&&x.tokens.length&&S(x.tokens,w=>{Me(P,w.regex)}));var H=w=>{let A=p.render(w,{input:m});return A&&(_=!0,P.insertBefore(A,P.firstChild)),A};if(p.loading?H("loading"):p.settings.shouldLoad.call(p,m)?x.items.length===0&&H("no_results"):H("not_loading"),c=p.canCreate(m),c&&(h=H("option_create")),p.hasOptions=x.items.length>0||c,_){if(x.items.length>0){if(!f&&p.settings.mode==="single"&&p.items[0]!=null&&(f=p.getOption(p.items[0])),!P.contains(f)){let w=0;h&&!p.settings.addPrecedence&&(w=1),f=p.selectable()[w]}}else h&&(f=h);t&&!p.isOpen&&(p.open(),p.scrollToOption(f,"auto")),p.setActiveOption(f)}else p.clearActiveOption(),t&&p.isOpen&&p.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(t,e=!1){const i=this;if(Array.isArray(t))return i.addOptions(t,e),!1;const n=M(t[i.settings.valueField]);return n===null||i.options.hasOwnProperty(n)?!1:(t.$order=t.$order||++i.order,t.$id=i.inputId+"-opt-"+t.$order,i.options[n]=t,i.lastQuery=null,e&&(i.userOptions[n]=e,i.trigger("option_add",n,t)),n)}addOptions(t,e=!1){S(t,i=>{this.addOption(i,e)})}registerOption(t){return this.addOption(t)}registerOptionGroup(t){var e=M(t[this.settings.optgroupValueField]);return e===null?!1:(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)}addOptionGroup(t,e){var i;e[this.settings.optgroupValueField]=t,(i=this.registerOptionGroup(e))&&this.trigger("optgroup_add",i,e)}removeOptionGroup(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.clearCache(),this.trigger("optgroup_remove",t))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(t,e){const i=this;var n,o;const r=M(t),a=M(e[i.settings.valueField]);if(r===null)return;const l=i.options[r];if(l==null)return;if(typeof a!="string")throw new Error("Value must be set in option data");const c=i.getOption(r),d=i.getItem(r);if(e.$order=e.$order||l.$order,delete i.options[r],i.uncacheValue(a),i.options[a]=e,c){if(i.dropdown_content.contains(c)){const h=i._render("option",e);dt(c,h),i.activeOption===c&&i.setActiveOption(h)}c.remove()}d&&(o=i.items.indexOf(r),o!==-1&&i.items.splice(o,1,a),n=i._render("item",e),d.classList.contains("active")&&F(n,"active"),dt(d,n)),i.lastQuery=null}removeOption(t,e){const i=this;t=q(t),i.uncacheValue(t),delete i.userOptions[t],delete i.options[t],i.lastQuery=null,i.trigger("option_remove",t),i.removeItem(t,e)}clearOptions(t){const e=(t||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const i={};S(this.options,(n,o)=>{e(n,o)&&(i[o]=n)}),this.options=this.sifter.items=i,this.lastQuery=null,this.trigger("option_clear")}clearFilter(t,e){return this.items.indexOf(e)>=0}getOption(t,e=!1){const i=M(t);if(i===null)return null;const n=this.options[i];if(n!=null){if(n.$div)return n.$div;if(e)return this._render("option",n)}return null}getAdjacent(t,e,i="option"){var n=this,o;if(!t)return null;i=="item"?o=n.controlChildren():o=n.dropdown_content.querySelectorAll("[data-selectable]");for(let r=0;r<o.length;r++)if(o[r]==t)return e>0?o[r+1]:o[r-1];return null}getItem(t){if(typeof t=="object")return t;var e=M(t);return e!==null?this.control.querySelector(`[data-value="${mt(e)}"]`):null}addItems(t,e){var i=this,n=Array.isArray(t)?t:[t];n=n.filter(r=>i.items.indexOf(r)===-1);const o=n[n.length-1];n.forEach(r=>{i.isPending=r!==o,i.addItem(r,e)})}addItem(t,e){var i=e?[]:["change","dropdown_close"];gt(this,i,()=>{var n,o;const r=this,a=r.settings.mode,l=M(t);if(!(l&&r.items.indexOf(l)!==-1&&(a==="single"&&r.close(),a==="single"||!r.settings.duplicates))&&!(l===null||!r.options.hasOwnProperty(l))&&(a==="single"&&r.clear(e),!(a==="multi"&&r.isFull()))){if(n=r._render("item",r.options[l]),r.control.contains(n)&&(n=n.cloneNode(!0)),o=r.isFull(),r.items.splice(r.caretPos,0,l),r.insertAtCaret(n),r.isSetup){if(!r.isPending&&r.settings.hideSelected){let c=r.getOption(l),d=r.getAdjacent(c,1);d&&r.setActiveOption(d)}!r.isPending&&!r.settings.closeAfterSelect&&r.refreshOptions(r.isFocused&&a!=="single"),r.settings.closeAfterSelect!=!1&&r.isFull()?r.close():r.isPending||r.positionDropdown(),r.trigger("item_add",l,n),r.isPending||r.updateOriginalInput({silent:e})}(!r.isPending||!o&&r.isFull())&&(r.inputState(),r.refreshState())}})}removeItem(t=null,e){const i=this;if(t=i.getItem(t),!t)return;var n,o;const r=t.dataset.value;n=yt(t),t.remove(),t.classList.contains("active")&&(o=i.activeItems.indexOf(t),i.activeItems.splice(o,1),D(t,"active")),i.items.splice(n,1),i.lastQuery=null,!i.settings.persist&&i.userOptions.hasOwnProperty(r)&&i.removeOption(r,e),n<i.caretPos&&i.setCaret(i.caretPos-1),i.updateOriginalInput({silent:e}),i.refreshState(),i.positionDropdown(),i.trigger("item_remove",r,t)}createItem(t=null,e=()=>{}){arguments.length===3&&(e=arguments[2]),typeof e!="function"&&(e=()=>{});var i=this,n=i.caretPos,o;if(t=t||i.inputValue(),!i.canCreate(t))return e(),!1;i.lock();var r=!1,a=l=>{if(i.unlock(),!l||typeof l!="object")return e();var c=M(l[i.settings.valueField]);if(typeof c!="string")return e();i.setTextboxValue(),i.addOption(l,!0),i.setCaret(n),i.addItem(c),e(l),r=!0};return typeof i.settings.create=="function"?o=i.settings.create.call(this,t,a):o={[i.settings.labelField]:t,[i.settings.valueField]:t},r||a(o),!0}refreshItems(){var t=this;t.lastQuery=null,t.isSetup&&t.addItems(t.items),t.updateOriginalInput(),t.refreshState()}refreshState(){const t=this;t.refreshValidityState();const e=t.isFull(),i=t.isLocked;t.wrapper.classList.toggle("rtl",t.rtl);const n=t.wrapper.classList;n.toggle("focus",t.isFocused),n.toggle("disabled",t.isDisabled),n.toggle("readonly",t.isReadOnly),n.toggle("required",t.isRequired),n.toggle("invalid",!t.isValid),n.toggle("locked",i),n.toggle("full",e),n.toggle("input-active",t.isFocused&&!t.isInputHidden),n.toggle("dropdown-active",t.isOpen),n.toggle("has-options",ke(t.options)),n.toggle("has-items",t.items.length>0)}refreshValidityState(){var t=this;t.input.validity&&(t.isValid=t.input.validity.valid,t.isInvalid=!t.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(t={}){const e=this;var i,n;const o=e.input.querySelector('option[value=""]');if(e.is_select_tag){let c=function(d,h,u){return d||(d=$('<option value="'+ot(h)+'">'+ot(u)+"</option>")),d!=o&&e.input.append(d),a.push(d),(d!=o||l>0)&&(d.selected=!0),d};var r=c;const a=[],l=e.input.querySelectorAll("option:checked").length;e.input.querySelectorAll("option:checked").forEach(d=>{d.selected=!1}),e.items.length==0&&e.settings.mode=="single"?c(o,"",""):e.items.forEach(d=>{if(i=e.options[d],n=i[e.settings.labelField]||"",a.includes(i.$option)){const h=e.input.querySelector(`option[value="${mt(d)}"]:not(:checked)`);c(h,d,n)}else i.$option=c(i.$option,d,n)})}else e.input.value=e.getValue();e.isSetup&&(t.silent||e.trigger("change",e.getValue()))}open(){var t=this;t.isLocked||t.isOpen||t.settings.mode==="multi"&&t.isFull()||(t.isOpen=!0,C(t.focus_node,{"aria-expanded":"true"}),t.refreshState(),Y(t.dropdown,{visibility:"hidden",display:"block"}),t.positionDropdown(),Y(t.dropdown,{visibility:"visible",display:"block"}),t.focus(),t.trigger("dropdown_open",t.dropdown))}close(t=!0){var e=this,i=e.isOpen;t&&(e.setTextboxValue(),e.settings.mode==="single"&&e.items.length&&e.inputState()),e.isOpen=!1,C(e.focus_node,{"aria-expanded":"false"}),Y(e.dropdown,{display:"none"}),e.settings.hideSelected&&e.clearActiveOption(),e.refreshState(),i&&e.trigger("dropdown_close",e.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var t=this.control,e=t.getBoundingClientRect(),i=t.offsetHeight+e.top+window.scrollY,n=e.left+window.scrollX;Y(this.dropdown,{width:e.width+"px",top:i+"px",left:n+"px"})}}clear(t){var e=this;if(e.items.length){var i=e.controlChildren();S(i,n=>{e.removeItem(n,!0)}),e.inputState(),t||e.updateOriginalInput(),e.trigger("clear")}}insertAtCaret(t){const e=this,i=e.caretPos,n=e.control;n.insertBefore(t,n.children[i]||null),e.setCaret(i+1)}deleteSelection(t){var e,i,n,o,r=this;e=t&&t.keyCode===wt?-1:1,i=Le(r.control_input);const a=[];if(r.activeItems.length)o=vt(r.activeItems,e),n=yt(o),e>0&&n++,S(r.activeItems,l=>a.push(l));else if((r.isFocused||r.settings.mode==="single")&&r.items.length){const l=r.controlChildren();let c;e<0&&i.start===0&&i.length===0?c=l[r.caretPos-1]:e>0&&i.start===r.inputValue().length&&(c=l[r.caretPos]),c!==void 0&&a.push(c)}if(!r.shouldDelete(a,t))return!1;for(E(t,!0),typeof n<"u"&&r.setCaret(n);a.length;)r.removeItem(a.pop());return r.inputState(),r.positionDropdown(),r.refreshOptions(!1),!0}shouldDelete(t,e){const i=t.map(n=>n.dataset.value);return!(!i.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(i,e)===!1)}advanceSelection(t,e){var i,n,o=this;o.rtl&&(t*=-1),!o.inputValue().length&&(R(U,e)||R("shiftKey",e)?(i=o.getLastActive(t),i?i.classList.contains("active")?n=o.getAdjacent(i,t,"item"):n=i:t>0?n=o.control_input.nextElementSibling:n=o.control_input.previousElementSibling,n&&(n.classList.contains("active")&&o.removeActiveItem(i),o.setActiveItemClass(n))):o.moveCaret(t))}moveCaret(t){}getLastActive(t){let e=this.control.querySelector(".last-active");if(e)return e;var i=this.control.querySelectorAll(".active");if(i)return vt(i,t)}setCaret(t){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(t=this.isReadOnly||this.isDisabled){this.isLocked=t,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(t){this.focus_node.tabIndex=t?-1:this.tabIndex,this.isDisabled=t,this.input.disabled=t,this.control_input.disabled=t,this.setLocked()}setReadOnly(t){this.isReadOnly=t,this.input.readOnly=t,this.control_input.readOnly=t,this.setLocked()}destroy(){var t=this,e=t.revertSettings;t.trigger("destroy"),t.off(),t.wrapper.remove(),t.dropdown.remove(),t.input.innerHTML=e.innerHTML,t.input.tabIndex=e.tabIndex,D(t.input,"tomselected","ts-hidden-accessible"),t._destroy(),delete t.input.tomselect}render(t,e){var i,n;const o=this;if(typeof this.settings.render[t]!="function"||(n=o.settings.render[t].call(this,e,ot),!n))return null;if(n=$(n),t==="option"||t==="option_create"?e[o.settings.disabledField]?C(n,{"aria-disabled":"true"}):C(n,{"data-selectable":""}):t==="optgroup"&&(i=e.group[o.settings.optgroupValueField],C(n,{"data-group":i}),e.group[o.settings.disabledField]&&C(n,{"data-disabled":""})),t==="option"||t==="item"){const r=q(e[o.settings.valueField]);C(n,{"data-value":r}),t==="item"?(F(n,o.settings.itemClass),C(n,{"data-ts-item":""})):(F(n,o.settings.optionClass),C(n,{role:"option",id:e.$id}),e.$div=n,o.options[r]=e)}return n}_render(t,e){const i=this.render(t,e);if(i==null)throw"HTMLElement expected";return i}clearCache(){S(this.options,t=>{t.$div&&(t.$div.remove(),delete t.$div)})}uncacheValue(t){const e=this.getOption(t);e&&e.remove()}canCreate(t){return this.settings.create&&t.length>0&&this.settings.createFilter.call(this,t)}hook(t,e,i){var n=this,o=n[e];n[e]=function(){var r,a;return t==="after"&&(r=o.apply(n,arguments)),a=i.apply(n,arguments),t==="instead"?a:(t==="before"&&(r=o.apply(n,arguments)),r)}}}const Ke=(s,t,e,i)=>{s.addEventListener(t,e,i)};function je(){Ke(this.input,"change",()=>{this.sync()})}const Qe=s=>typeof s>"u"||s===null?null:We(s),We=s=>typeof s=="boolean"?s?"1":"0":s+"",Ct=(s,t=!1)=>{s&&(s.preventDefault(),t&&s.stopPropagation())},Ye=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(Ue(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},Ue=s=>typeof s=="string"&&s.indexOf("<")>-1;function Ze(s){var t=this,e=t.onOptionSelect;t.settings.hideSelected=!1;const i=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},s);var n=function(a,l){l?(a.checked=!0,i.uncheckedClassNames&&a.classList.remove(...i.uncheckedClassNames),i.checkedClassNames&&a.classList.add(...i.checkedClassNames)):(a.checked=!1,i.checkedClassNames&&a.classList.remove(...i.checkedClassNames),i.uncheckedClassNames&&a.classList.add(...i.uncheckedClassNames))},o=function(a){setTimeout(()=>{var l=a.querySelector("input."+i.className);l instanceof HTMLInputElement&&n(l,a.classList.contains("selected"))},1)};t.hook("after","setupTemplates",()=>{var r=t.settings.render.option;t.settings.render.option=(a,l)=>{var c=Ye(r.call(t,a,l)),d=document.createElement("input");i.className&&d.classList.add(i.className),d.addEventListener("click",function(u){Ct(u)}),d.type="checkbox";const h=Qe(a[t.settings.valueField]);return n(d,!!(h&&t.items.indexOf(h)>-1)),c.prepend(d),c}}),t.on("item_remove",r=>{var a=t.getOption(r);a&&(a.classList.remove("selected"),o(a))}),t.on("item_add",r=>{var a=t.getOption(r);a&&o(a)}),t.hook("instead","onOptionSelect",(r,a)=>{if(a.classList.contains("selected")){a.classList.remove("selected"),t.removeItem(a.dataset.value),t.refreshOptions(),Ct(r,!0);return}e.call(t,r,a),o(a)})}const qe=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(Je(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},Je=s=>typeof s=="string"&&s.indexOf("<")>-1;function Xe(s){const t=this,e=Object.assign({className:"clear-button",title:"Clear All",html:i=>`<div class="${i.className}" title="${i.title}">&#10799;</div>`},s);t.on("initialize",()=>{var i=qe(e.html(e));i.addEventListener("click",n=>{t.isLocked||(t.clear(),t.settings.mode==="single"&&t.settings.allowEmptyOption&&t.addItem(""),n.preventDefault(),n.stopPropagation())}),t.control.appendChild(i)})}const ts=(s,t=!1)=>{s&&(s.preventDefault(),t&&s.stopPropagation())},V=(s,t,e,i)=>{s.addEventListener(t,e,i)},es=(s,t)=>{if(Array.isArray(s))s.forEach(t);else for(var e in s)s.hasOwnProperty(e)&&t(s[e],e)},ss=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(is(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},is=s=>typeof s=="string"&&s.indexOf("<")>-1,ns=(s,t)=>{es(t,(e,i)=>{e==null?s.removeAttribute(i):s.setAttribute(i,""+e)})},rs=(s,t)=>{var e;(e=s.parentNode)==null||e.insertBefore(t,s.nextSibling)},os=(s,t)=>{var e;(e=s.parentNode)==null||e.insertBefore(t,s)},as=(s,t)=>{do{var e;if(t=(e=t)==null?void 0:e.previousElementSibling,s==t)return!0}while(t&&t.previousElementSibling);return!1};function ls(){var s=this;if(s.settings.mode!=="multi")return;var t=s.lock,e=s.unlock;let i=!0,n;s.hook("after","setupTemplates",()=>{var o=s.settings.render.item;s.settings.render.item=(r,a)=>{const l=ss(o.call(s,r,a));ns(l,{draggable:"true"});const c=m=>{i||ts(m),m.stopPropagation()},d=m=>{n=l,setTimeout(()=>{l.classList.add("ts-dragging")},0)},h=m=>{m.preventDefault(),l.classList.add("ts-drag-over"),y(l,n)},u=()=>{l.classList.remove("ts-drag-over")},y=(m,O)=>{O!==void 0&&(as(O,l)?rs(m,O):os(m,O))},p=()=>{var m;document.querySelectorAll(".ts-drag-over").forEach(x=>x.classList.remove("ts-drag-over")),(m=n)==null||m.classList.remove("ts-dragging"),n=void 0;var O=[];s.control.querySelectorAll("[data-value]").forEach(x=>{if(x.dataset.value){let f=x.dataset.value;f&&O.push(f)}}),s.setValue(O)};return V(l,"mousedown",c),V(l,"dragstart",d),V(l,"dragenter",h),V(l,"dragover",h),V(l,"dragleave",u),V(l,"dragend",p),l}}),s.hook("instead","lock",()=>(i=!1,t.call(s))),s.hook("instead","unlock",()=>(i=!0,e.call(s)))}const cs=(s,t=!1)=>{s&&(s.preventDefault(),t&&s.stopPropagation())},ds=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(hs(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},hs=s=>typeof s=="string"&&s.indexOf("<")>-1;function us(s){const t=this,e=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:i=>'<div class="'+i.headerClass+'"><div class="'+i.titleRowClass+'"><span class="'+i.labelClass+'">'+i.title+'</span><a class="'+i.closeClass+'">&times;</a></div></div>'},s);t.on("initialize",()=>{var i=ds(e.html(e)),n=i.querySelector("."+e.closeClass);n&&n.addEventListener("click",o=>{cs(o,!0),t.close()}),t.dropdown.insertBefore(i,t.dropdown.firstChild)})}const ps=(s,t)=>{if(Array.isArray(s))s.forEach(t);else for(var e in s)s.hasOwnProperty(e)&&t(s[e],e)},fs=(s,...t)=>{var e=gs(t);s=ms(s),s.map(i=>{e.map(n=>{i.classList.remove(n)})})},gs=s=>{var t=[];return ps(s,e=>{typeof e=="string"&&(e=e.trim().split(/[\t\n\f\r\s]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},ms=s=>(Array.isArray(s)||(s=[s]),s),vs=(s,t)=>{if(!s)return-1;t=t||s.nodeName;for(var e=0;s=s.previousElementSibling;)s.matches(t)&&e++;return e};function ys(){var s=this;s.hook("instead","setCaret",t=>{s.settings.mode==="single"||!s.control.contains(s.control_input)?t=s.items.length:(t=Math.max(0,Math.min(s.items.length,t)),t!=s.caretPos&&!s.isPending&&s.controlChildren().forEach((e,i)=>{i<t?s.control_input.insertAdjacentElement("beforebegin",e):s.control.appendChild(e)})),s.caretPos=t}),s.hook("instead","moveCaret",t=>{if(!s.isFocused)return;const e=s.getLastActive(t);if(e){const i=vs(e);s.setCaret(t>0?i+1:i),s.setActiveItem(),fs(e,"last-active")}else s.setCaret(s.caretPos+t)})}const ws=27,As=9,xs=(s,t=!1)=>{s&&(s.preventDefault(),t&&s.stopPropagation())},bs=(s,t,e,i)=>{s.addEventListener(t,e,i)},Os=(s,t)=>{if(Array.isArray(s))s.forEach(t);else for(var e in s)s.hasOwnProperty(e)&&t(s[e],e)},_t=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(Cs(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},Cs=s=>typeof s=="string"&&s.indexOf("<")>-1,_s=(s,...t)=>{var e=Es(t);s=Ss(s),s.map(i=>{e.map(n=>{i.classList.add(n)})})},Es=s=>{var t=[];return Os(s,e=>{typeof e=="string"&&(e=e.trim().split(/[\t\n\f\r\s]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},Ss=s=>(Array.isArray(s)||(s=[s]),s);function Is(){const s=this;s.settings.shouldOpen=!0,s.hook("before","setup",()=>{s.focus_node=s.control,_s(s.control_input,"dropdown-input");const t=_t('<div class="dropdown-input-wrap">');t.append(s.control_input),s.dropdown.insertBefore(t,s.dropdown.firstChild);const e=_t('<input class="items-placeholder" tabindex="-1" />');e.placeholder=s.settings.placeholder||"",s.control.append(e)}),s.on("initialize",()=>{s.control_input.addEventListener("keydown",e=>{switch(e.keyCode){case ws:s.isOpen&&(xs(e,!0),s.close()),s.clearActiveItems();return;case As:s.focus_node.tabIndex=-1;break}return s.onKeyDown.call(s,e)}),s.on("blur",()=>{s.focus_node.tabIndex=s.isDisabled?-1:s.tabIndex}),s.on("dropdown_open",()=>{s.control_input.focus()});const t=s.onBlur;s.hook("instead","onBlur",e=>{if(!(e&&e.relatedTarget==s.control_input))return t.call(s)}),bs(s.control_input,"blur",()=>s.onBlur()),s.hook("before","close",()=>{s.isOpen&&s.focus_node.focus({preventScroll:!0})})})}const Z=(s,t,e,i)=>{s.addEventListener(t,e,i)};function Ts(){var s=this;s.on("initialize",()=>{var t=document.createElement("span"),e=s.control_input;t.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",s.wrapper.appendChild(t);var i=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of i)t.style[o]=e.style[o];var n=()=>{t.textContent=e.value,e.style.width=t.clientWidth+"px"};n(),s.on("update item_add item_remove",n),Z(e,"input",n),Z(e,"keyup",n),Z(e,"blur",n),Z(e,"update",n)})}function Ls(){var s=this,t=s.deleteSelection;this.hook("instead","deleteSelection",e=>s.activeItems.length?t.call(s,e):!1)}function Fs(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const Et=37,ks=39,Ms=(s,t,e)=>{for(;s&&s.matches;){if(s.matches(t))return s;s=s.parentNode}},Ps=(s,t)=>{if(!s)return-1;t=t||s.nodeName;for(var e=0;s=s.previousElementSibling;)s.matches(t)&&e++;return e};function $s(){var s=this,t=s.onKeyDown;s.hook("instead","onKeyDown",e=>{var i,n,o,r;if(!s.isOpen||!(e.keyCode===Et||e.keyCode===ks))return t.call(s,e);s.ignoreHover=!0,r=Ms(s.activeOption,"[data-group]"),i=Ps(s.activeOption,"[data-selectable]"),r&&(e.keyCode===Et?r=r.previousSibling:r=r.nextSibling,r&&(o=r.querySelectorAll("[data-selectable]"),n=o[Math.min(o.length-1,i)],n&&s.setActiveOption(n)))})}const Ds=s=>(s+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),St=(s,t=!1)=>{s&&(s.preventDefault(),t&&s.stopPropagation())},It=(s,t,e,i)=>{s.addEventListener(t,e,i)},Tt=s=>{if(s.jquery)return s[0];if(s instanceof HTMLElement)return s;if(Bs(s)){var t=document.createElement("template");return t.innerHTML=s.trim(),t.content.firstChild}return document.querySelector(s)},Bs=s=>typeof s=="string"&&s.indexOf("<")>-1;function Rs(s){const t=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},s);var e=this;if(t.append){var i='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+Ds(t.title)+'">'+t.label+"</a>";e.hook("after","setupTemplates",()=>{var n=e.settings.render.item;e.settings.render.item=(o,r)=>{var a=Tt(n.call(e,o,r)),l=Tt(i);return a.appendChild(l),It(l,"mousedown",c=>{St(c,!0)}),It(l,"click",c=>{e.isLocked||(St(c,!0),!e.isLocked&&e.shouldDelete([a],c)&&(e.removeItem(a),e.refreshOptions(!1),e.inputState()))}),a}})}}function Ns(s){const t=this,e=Object.assign({text:i=>i[t.settings.labelField]},s);t.on("item_remove",function(i){if(t.isFocused&&t.control_input.value.trim()===""){var n=t.options[i];n&&t.setTextboxValue(e.text.call(t,n))}})}const Hs=(s,t)=>{if(Array.isArray(s))s.forEach(t);else for(var e in s)s.hasOwnProperty(e)&&t(s[e],e)},Vs=(s,...t)=>{var e=Gs(t);s=zs(s),s.map(i=>{e.map(n=>{i.classList.add(n)})})},Gs=s=>{var t=[];return Hs(s,e=>{typeof e=="string"&&(e=e.trim().split(/[\t\n\f\r\s]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},zs=s=>(Array.isArray(s)||(s=[s]),s);function Ks(){const s=this,t=s.canLoad,e=s.clearActiveOption,i=s.loadCallback;var n={},o,r=!1,a,l=[];if(s.settings.shouldLoadMore||(s.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(s.activeOption){var u=s.selectable(),y=Array.from(u).indexOf(s.activeOption);if(y>=u.length-2)return!0}return!1}),!s.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";s.settings.sortField=[{field:"$order"},{field:"$score"}];const c=h=>typeof s.settings.maxOptions=="number"&&o.children.length>=s.settings.maxOptions?!1:!!(h in n&&n[h]),d=(h,u)=>s.items.indexOf(u)>=0||l.indexOf(u)>=0;s.setNextUrl=(h,u)=>{n[h]=u},s.getUrl=h=>{if(h in n){const u=n[h];return n[h]=!1,u}return s.clearPagination(),s.settings.firstUrl.call(s,h)},s.clearPagination=()=>{n={}},s.hook("instead","clearActiveOption",()=>{if(!r)return e.call(s)}),s.hook("instead","canLoad",h=>h in n?c(h):t.call(s,h)),s.hook("instead","loadCallback",(h,u)=>{if(!r)s.clearOptions(d);else if(a){const y=h[0];y!==void 0&&(a.dataset.value=y[s.settings.valueField])}i.call(s,h,u),r=!1}),s.hook("after","refreshOptions",()=>{const h=s.lastValue;var u;c(h)?(u=s.render("loading_more",{query:h}),u&&(u.setAttribute("data-selectable",""),a=u)):h in n&&!o.querySelector(".no-results")&&(u=s.render("no_more_results",{query:h})),u&&(Vs(u,s.settings.optionClass),o.append(u))}),s.on("initialize",()=>{l=Object.keys(s.options),o=s.dropdown_content,s.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},s.settings.render),o.addEventListener("scroll",()=>{s.settings.shouldLoadMore.call(s)&&c(s.lastValue)&&(r||(r=!0,s.load.call(s,s.lastValue)))})})}L.define("change_listener",je);L.define("checkbox_options",Ze);L.define("clear_button",Xe);L.define("drag_drop",ls);L.define("dropdown_header",us);L.define("caret_position",ys);L.define("dropdown_input",Is);L.define("input_autogrow",Ts);L.define("no_backspace_delete",Ls);L.define("no_active_items",Fs);L.define("optgroup_columns",$s);L.define("remove_button",Rs);L.define("restore_on_backspace",Ns);L.define("virtual_scroll",Ks);window.TomSelect=L;document.addEventListener("DOMContentLoaded",()=>{new re});
